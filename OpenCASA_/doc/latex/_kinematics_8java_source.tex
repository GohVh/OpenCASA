\hypertarget{_kinematics_8java_source}{}\section{Kinematics.\+java}
\label{_kinematics_8java_source}\index{Kinematics.\+java@{Kinematics.\+java}}

\begin{DoxyCode}
00001 \textcolor{comment}{/*}
00002 \textcolor{comment}{ *   OpenCASA software v0.8 for video and image analysis}
00003 \textcolor{comment}{ *   Copyright (C) 2017  Carlos Alqu√©zar}
00004 \textcolor{comment}{ *}
00005 \textcolor{comment}{ *   This program is free software: you can redistribute it and/or modify}
00006 \textcolor{comment}{ *   it under the terms of the GNU General Public License as published by}
00007 \textcolor{comment}{ *   the Free Software Foundation, either version 3 of the License, or}
00008 \textcolor{comment}{ *   (at your option) any later version.}
00009 \textcolor{comment}{ *}
00010 \textcolor{comment}{ *   This program is distributed in the hope that it will be useful,}
00011 \textcolor{comment}{ *   but WITHOUT ANY WARRANTY; without even the implied warranty of}
00012 \textcolor{comment}{ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00013 \textcolor{comment}{ *   GNU General Public License for more details.}
00014 \textcolor{comment}{ *}
00015 \textcolor{comment}{ *   You should have received a copy of the GNU General Public License}
00016 \textcolor{comment}{ *   along with this program.  If not, see <https://www.gnu.org/licenses/>.}
00017 \textcolor{comment}{*/}    
00018 
00019 \textcolor{keyword}{package }functions;
00020 
00021 \textcolor{keyword}{import} java.util.ArrayList;
00022 \textcolor{keyword}{import} java.util.List;
00023 \textcolor{keyword}{import} java.util.ListIterator;
00024 
00025 \textcolor{keyword}{import} \hyperlink{namespacedata}{data}.\hyperlink{classdata_1_1_params}{Params};
00026 \textcolor{keyword}{import} \hyperlink{namespacedata}{data}.\hyperlink{classdata_1_1_serializable_list}{SerializableList};
00027 \textcolor{keyword}{import} \hyperlink{namespacedata}{data}.\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon};
00028 
\hypertarget{_kinematics_8java_source_l00033}{}\hyperlink{classfunctions_1_1_kinematics}{00033} \textcolor{keyword}{public} \textcolor{keyword}{class }\hyperlink{classfunctions_1_1_kinematics}{Kinematics} \{
00034   \textcolor{comment}{/******************************************************/}
\hypertarget{_kinematics_8java_source_l00042}{}\hyperlink{classfunctions_1_1_kinematics_a8f8221f314e814927fb192ea65f2af4a}{00042}   \textcolor{keyword}{public} \textcolor{keywordtype}{float}[] \hyperlink{classfunctions_1_1_kinematics_a8f8221f314e814927fb192ea65f2af4a}{alh}(List track, List avgTrack) \{
00043 
00044     \textcolor{keywordtype}{int} length = avgTrack.size();
00045     \textcolor{keywordtype}{float} \hyperlink{classfunctions_1_1_kinematics_a8f8221f314e814927fb192ea65f2af4a}{alh}[] = \textcolor{keyword}{new} \textcolor{keywordtype}{float}[2];
00046     \textcolor{keywordtype}{float} alhMax = 0;
00047     \textcolor{keywordtype}{float} alhMean = 0;
00048     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < length; i++) \{
00049       \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} origSpermatozoon = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) track.get(i + 
      \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_ad1b7844e5f66ee81c3de06d1a8ca645e}{wSize} / 2 - 1);
00050       \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} avgSpermatozoon = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) avgTrack.get(i);
00051       \textcolor{keywordtype}{float} distance = origSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_aaef7a8e7602a08c82ea5fcbb777883e0}{distance}(avgSpermatozoon);
00052       alhMean += distance;
00053       \textcolor{keywordflow}{if} (distance > alhMax)
00054         alhMax = distance;
00055     \}
00056     \textcolor{comment}{// Mean value}
00057     alhMean = alhMean / length;
00058     \textcolor{comment}{// convert pixels to micrometers}
00059     alh[0] = alhMean * (float) \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a19331ee97ef3c422984fc7dff976549e}{micronPerPixel};
00060     alh[1] = alhMax * (\textcolor{keywordtype}{float}) \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a19331ee97ef3c422984fc7dff976549e}{micronPerPixel};
00061 
00062     \textcolor{keywordflow}{return} \hyperlink{classfunctions_1_1_kinematics_a8f8221f314e814927fb192ea65f2af4a}{alh};
00063   \}
00064 
00065   \textcolor{comment}{/******************************************************/}
00066 
00074   \textcolor{comment}{// public float bcf(List track,List avgTrack)\{}
00075   \textcolor{comment}{//}
00076   \textcolor{comment}{// int length = avgTrack.size();}
00077   \textcolor{comment}{// int intersections=0;}
00078   \textcolor{comment}{// // bcf\_shift equal to 1 is not enougth to catch all beat-cross}
00079   \textcolor{comment}{// for (int i=1;i<length;i=i+1+Params.bcf\_shift)\{}
00080   \textcolor{comment}{// Spermatozoon origP0 =}
00081   \textcolor{comment}{// (Spermatozoon)track.get(i-Params.bcf\_shift+Params.wSize/2-1);}
00082   \textcolor{comment}{// Spermatozoon origP1 = (Spermatozoon)track.get(i+Params.wSize/2-1);}
00083   \textcolor{comment}{// Spermatozoon avgP0 = (Spermatozoon)avgTrack.get(i-Params.bcf\_shift);}
00084   \textcolor{comment}{// Spermatozoon avgP1 = (Spermatozoon)avgTrack.get(i);}
00085   \textcolor{comment}{// Line2D origLine = new Line2D.Float();}
00086   \textcolor{comment}{// origLine.setLine(origP0.x,origP0.y,origP1.x,origP1.y);}
00087   \textcolor{comment}{// Line2D avgLine = new Line2D.Float();}
00088   \textcolor{comment}{// avgLine.setLine(avgP0.x,avgP0.y,avgP1.x,avgP1.y);}
00089   \textcolor{comment}{//}
00090   \textcolor{comment}{// boolean intersection = origLine.intersectsLine(avgLine);}
00091   \textcolor{comment}{// if(intersection)}
00092   \textcolor{comment}{// intersections++;}
00093   \textcolor{comment}{// \}}
00094   \textcolor{comment}{// float bcf\_value = (float)intersections*Params.frameRate/(float)length;}
00095   \textcolor{comment}{//}
00096   \textcolor{comment}{// return bcf\_value;}
00097   \textcolor{comment}{// \}}
\hypertarget{_kinematics_8java_source_l00103}{}\hyperlink{classfunctions_1_1_kinematics_ac35b9a912f923321eee5335c011f7c89}{00103} \textcolor{comment}{}  \textcolor{keyword}{public} \textcolor{keywordtype}{float} \hyperlink{classfunctions_1_1_kinematics_ac35b9a912f923321eee5335c011f7c89}{bcf}(List track, List avgTrack) \{
00104 
00105     \textcolor{keywordtype}{int} nAvgPoints = avgTrack.size();
00106     \textcolor{keywordtype}{float}[] dists = \textcolor{keyword}{new} \textcolor{keywordtype}{float}[nAvgPoints];
00107     \textcolor{keywordtype}{int}[] xPoints = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[nAvgPoints];
00108     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < nAvgPoints; i++) \{
00109       \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} origS = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) track.get(i + 
      \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_ad1b7844e5f66ee81c3de06d1a8ca645e}{wSize} / 2 - 1);
00110       \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} avgS = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) avgTrack.get(i);
00111       dists[i] = origS.\hyperlink{classdata_1_1_spermatozoon_aaef7a8e7602a08c82ea5fcbb777883e0}{distance}(avgS);
00112     \}
00113     \hyperlink{classfunctions_1_1_signal_processing}{SignalProcessing} sp = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_signal_processing}{SignalProcessing}();
00114     dists = sp.\hyperlink{classfunctions_1_1_signal_processing_a4f10245c50d850b87d1ef4d81c28300d}{movingAverage}(dists, 2);
00115     \textcolor{keywordtype}{int} intersections = countLocalMaximas(dists);
00116     \textcolor{keywordtype}{float} bcf\_value = (float) intersections * \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a398ccb086e2e7150576bec8a5853b8e3}{frameRate} / (\textcolor{keywordtype}{float}) nAvgPoints;
00117     \textcolor{keywordflow}{return} bcf\_value;
00118   \}
00119 
00124   \textcolor{keywordtype}{int} countLocalMaximas(\textcolor{keywordtype}{float}[] points) \{
00125     \textcolor{keywordtype}{int} nPoints = points.length;
00126     \textcolor{keywordtype}{int} count = 0;
00127     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 2; i < nPoints; i++) \{
00128       \textcolor{keywordtype}{float} x0 = points[i - 2];
00129       \textcolor{keywordtype}{float} x1 = points[i - 1];
00130       \textcolor{keywordtype}{float} x2 = points[i];
00131       \textcolor{keywordflow}{if} (((x1 > x0) & (x1 > x2)) || ((x1 < x0) & (x1 < x2)))
00132         count++;
00133     \}
00134     \textcolor{keywordflow}{return} count;
00135   \}
00136 
00137   \textcolor{comment}{/******************************************************/}
\hypertarget{_kinematics_8java_source_l00142}{}\hyperlink{classfunctions_1_1_kinematics_a55fee1cc65c19a5862bd9fdce3aa9cd5}{00142}   \textcolor{keyword}{public} String \hyperlink{classfunctions_1_1_kinematics_a55fee1cc65c19a5862bd9fdce3aa9cd5}{getVelocityTrackType}(List track) \{
00143 
00144     \hyperlink{classfunctions_1_1_signal_processing}{SignalProcessing} sp = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_signal_processing}{SignalProcessing}();
00145     List avgTrack = sp.\hyperlink{classfunctions_1_1_signal_processing_a4f10245c50d850b87d1ef4d81c28300d}{movingAverage}(track);
00146     \textcolor{keywordtype}{float} vap = \hyperlink{classfunctions_1_1_kinematics_af6e1e75567a927a9c627616cb68b0d7f}{vcl}(avgTrack);
00147     \textcolor{keywordflow}{if} ((\hyperlink{classfunctions_1_1_kinematics_a938c4a9daa152f426259a01bc6654b25}{vsl}(track) < \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_af9a2118a2e00978d900279677c64bbeb}{vclLowerTh}) || (\hyperlink{classfunctions_1_1_kinematics_af6e1e75567a927a9c627616cb68b0d7f}{vcl}(track) < 
      \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_af9a2118a2e00978d900279677c64bbeb}{vclLowerTh}) || (vap < \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_af9a2118a2e00978d900279677c64bbeb}{vclLowerTh}))
00148       \textcolor{keywordflow}{return} \textcolor{stringliteral}{"Slow"};
00149     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((\hyperlink{classfunctions_1_1_kinematics_a938c4a9daa152f426259a01bc6654b25}{vsl}(track) > \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_ae0c29f446e3d569d730c8251a31e7ac2}{vclUpperTh}) || (\hyperlink{classfunctions_1_1_kinematics_af6e1e75567a927a9c627616cb68b0d7f}{vcl}(track) > 
      \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_ae0c29f446e3d569d730c8251a31e7ac2}{vclUpperTh}) || (vap > \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_ae0c29f446e3d569d730c8251a31e7ac2}{vclUpperTh}))
00150       \textcolor{keywordflow}{return} \textcolor{stringliteral}{"Fast"};
00151     \textcolor{keywordflow}{else}
00152       \textcolor{keywordflow}{return} \textcolor{stringliteral}{"Normal"};
00153   \}
00154 
00155   \textcolor{comment}{/******************************************************/}
\hypertarget{_kinematics_8java_source_l00161}{}\hyperlink{classfunctions_1_1_kinematics_a2b60196aad8d0eecb1c3048e0163ebc3}{00161}   \textcolor{keyword}{public} \textcolor{keywordtype}{float} \hyperlink{classfunctions_1_1_kinematics_a2b60196aad8d0eecb1c3048e0163ebc3}{mad}(List track) \{
00162 
00163     \textcolor{keywordtype}{int} length = track.size();
00164     ListIterator jT = track.listIterator();
00165     \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} oldSpermatozoon = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) jT.next();
00166     \textcolor{keywordtype}{float} totalDegrees = 0;
00167     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 1; i < length; i++) \{
00168       \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} newSpermatozoon = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) track.get(i);
00169       \textcolor{keywordtype}{float} diffX = newSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_ad0da36b2558901e21e7a30f6c227a45e}{x} - oldSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_ad0da36b2558901e21e7a30f6c227a45e}{x};
00170       \textcolor{keywordtype}{float} diffY = newSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_aa4f0d3eebc3c443f9be81bf48561a217}{y} - oldSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_aa4f0d3eebc3c443f9be81bf48561a217}{y};
00171       \textcolor{keywordtype}{double} angle = (2 * Math.PI + Math.atan2(diffY, diffX)) % (2 * Math.PI);
00172       totalDegrees += angle;
00173       oldSpermatozoon = newSpermatozoon;
00174     \}
00175     \textcolor{comment}{// mean angle}
00176     \textcolor{keywordtype}{float} meanAngle = totalDegrees / (length - 1);
00177     \textcolor{keywordflow}{return} meanAngle;
00178   \}
00179 
00180   \textcolor{comment}{/******************************************************/}
\hypertarget{_kinematics_8java_source_l00185}{}\hyperlink{classfunctions_1_1_kinematics_a5dbef047c19d4c554b08ba879eb7443f}{00185}   \textcolor{keyword}{public} \textcolor{keywordtype}{boolean} \hyperlink{classfunctions_1_1_kinematics_a5dbef047c19d4c554b08ba879eb7443f}{motilityTest}(List track) \{
00186 
00187     \hyperlink{classfunctions_1_1_kinematics}{Kinematics} K = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_kinematics}{Kinematics}();
00188     \textcolor{keywordtype}{int} nPoints = track.size();
00189     \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} firstSpermatozoon = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) track.get(0);
00190     \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} lastSpermatozoon = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) track.get(nPoints - 1);
00191     \textcolor{keywordtype}{float} distance = lastSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_aaef7a8e7602a08c82ea5fcbb777883e0}{distance}(firstSpermatozoon);
00192     \hyperlink{classfunctions_1_1_signal_processing}{SignalProcessing} sp = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_signal_processing}{SignalProcessing}();
00193     List avgTrack = sp.\hyperlink{classfunctions_1_1_signal_processing_a4f10245c50d850b87d1ef4d81c28300d}{movingAverage}(track);
00194     \textcolor{keywordtype}{float} vap = K.\hyperlink{classfunctions_1_1_kinematics_af6e1e75567a927a9c627616cb68b0d7f}{vcl}(avgTrack) / K.\hyperlink{classfunctions_1_1_kinematics_a938c4a9daa152f426259a01bc6654b25}{vsl}(avgTrack);
00195     \textcolor{comment}{// Kinematics filter}
00196     \textcolor{keywordtype}{double} minPixelDistance = 10;\textcolor{comment}{// 10/Params.micronPerPixel;}
00197     \textcolor{keywordflow}{if} (K.\hyperlink{classfunctions_1_1_kinematics_af6e1e75567a927a9c627616cb68b0d7f}{vcl}(track) > \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_af4cb43f0bfe24c14e75780187235376c}{vclMin} && (distance > minPixelDistance) && (vap > 0))
00198       \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00199     \textcolor{keywordflow}{else}
00200       \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00201   \}
00202 
00203   \textcolor{comment}{/******************************************************/}
\hypertarget{_kinematics_8java_source_l00208}{}\hyperlink{classfunctions_1_1_kinematics_a0bde63a25091ffc7c7af6d9fffe78034}{00208}   \textcolor{keyword}{public} \textcolor{keywordtype}{int}[] \hyperlink{classfunctions_1_1_kinematics_a0bde63a25091ffc7c7af6d9fffe78034}{motilityTest}(\hyperlink{classdata_1_1_serializable_list}{SerializableList} theTracks) \{
00209     \textcolor{keywordtype}{int} motile = 0;
00210     \textcolor{keywordtype}{int} nonMotile = 0;
00211     \textcolor{keywordflow}{for} (ListIterator iT = theTracks.listIterator(); iT.hasNext();) \{
00212       List aTrack = (ArrayList) iT.next();
00213       \textcolor{keywordflow}{if} (\hyperlink{classfunctions_1_1_kinematics_a5dbef047c19d4c554b08ba879eb7443f}{motilityTest}(aTrack))
00214         motile++;
00215       \textcolor{keywordflow}{else}
00216         nonMotile++;
00217     \}
00218     \textcolor{keywordtype}{int}[] results = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[2];
00219     results[0] = motile;
00220     results[1] = nonMotile;
00221     \textcolor{keywordflow}{return} results;
00222   \}
00223   
00224   \textcolor{comment}{/******************************************************/}
\hypertarget{_kinematics_8java_source_l00230}{}\hyperlink{classfunctions_1_1_kinematics_af6e1e75567a927a9c627616cb68b0d7f}{00230}   \textcolor{keyword}{public} \textcolor{keywordtype}{float} \hyperlink{classfunctions_1_1_kinematics_af6e1e75567a927a9c627616cb68b0d7f}{vcl}(List track) \{
00231 
00232     \textcolor{keywordtype}{int} length = track.size();
00233     ListIterator jT = track.listIterator();
00234     \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} oldSpermatozoon = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) jT.next();
00235     \textcolor{keywordtype}{float} distance = 0;
00236     \textcolor{keywordflow}{for} (; jT.hasNext();) \{
00237       \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} newSpermatozoon = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) jT.next();
00238       distance += newSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_aaef7a8e7602a08c82ea5fcbb777883e0}{distance}(oldSpermatozoon);
00239       oldSpermatozoon = newSpermatozoon;
00240     \}
00241     \textcolor{comment}{// convert pixels to micrometers}
00242     distance = distance * (float) \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a19331ee97ef3c422984fc7dff976549e}{micronPerPixel};
00243     \textcolor{comment}{// Seconds}
00244     \textcolor{keywordtype}{float} elapsedTime = (length - 1) / \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a398ccb086e2e7150576bec8a5853b8e3}{frameRate};
00245     \textcolor{comment}{// return um/second}
00246     \textcolor{keywordflow}{return} distance / elapsedTime;
00247   \}
00248 
00249   \textcolor{comment}{/******************************************************/}
\hypertarget{_kinematics_8java_source_l00255}{}\hyperlink{classfunctions_1_1_kinematics_a938c4a9daa152f426259a01bc6654b25}{00255}   \textcolor{keyword}{public} \textcolor{keywordtype}{float} \hyperlink{classfunctions_1_1_kinematics_a938c4a9daa152f426259a01bc6654b25}{vsl}(List track) \{
00256 
00257     \textcolor{keywordtype}{int} length = track.size();
00258     \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} first = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) track.get(0);
00259     \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} last = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) track.get(length - 1);
00260     \textcolor{comment}{// Distance (pixels)}
00261     \textcolor{keywordtype}{float} distance = last.\hyperlink{classdata_1_1_spermatozoon_aaef7a8e7602a08c82ea5fcbb777883e0}{distance}(first);
00262     \textcolor{comment}{// convert pixels to micrometers}
00263     distance = distance * (float) \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a19331ee97ef3c422984fc7dff976549e}{micronPerPixel};
00264     \textcolor{comment}{// Seconds}
00265     \textcolor{keywordtype}{float} elapsedTime = (length - 1) / \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a398ccb086e2e7150576bec8a5853b8e3}{frameRate};
00266     \textcolor{comment}{// return um/second}
00267     \textcolor{keywordflow}{return} distance / elapsedTime;
00268   \}
00269 
00270 \}
\end{DoxyCode}
