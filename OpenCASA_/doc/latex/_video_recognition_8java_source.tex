\hypertarget{_video_recognition_8java_source}{}\section{Video\+Recognition.\+java}
\label{_video_recognition_8java_source}\index{Video\+Recognition.\+java@{Video\+Recognition.\+java}}

\begin{DoxyCode}
00001 \textcolor{comment}{/*}
00002 \textcolor{comment}{ *   OpenCASA software v0.8 for video and image analysis}
00003 \textcolor{comment}{ *   Copyright (C) 2017  Carlos Alquézar}
00004 \textcolor{comment}{ *}
00005 \textcolor{comment}{ *   This program is free software: you can redistribute it and/or modify}
00006 \textcolor{comment}{ *   it under the terms of the GNU General Public License as published by}
00007 \textcolor{comment}{ *   the Free Software Foundation, either version 3 of the License, or}
00008 \textcolor{comment}{ *   (at your option) any later version.}
00009 \textcolor{comment}{ *}
00010 \textcolor{comment}{ *   This program is distributed in the hope that it will be useful,}
00011 \textcolor{comment}{ *   but WITHOUT ANY WARRANTY; without even the implied warranty of}
00012 \textcolor{comment}{ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00013 \textcolor{comment}{ *   GNU General Public License for more details.}
00014 \textcolor{comment}{ *}
00015 \textcolor{comment}{ *   You should have received a copy of the GNU General Public License}
00016 \textcolor{comment}{ *   along with this program.  If not, see <https://www.gnu.org/licenses/>.}
00017 \textcolor{comment}{ *   }
00018 \textcolor{comment}{}
00019 \textcolor{comment}{Part of this code (detectSpermatozoa and idendifyTracks methods in particular) is a modification of a
       previous code }
00020 \textcolor{comment}{written by Jonas Wilson-Leedy and Rolf Ingermann and publish in CASA\_ plugin for ImageJ.}
00021 \textcolor{comment}{Copyright © 2003 The Regents of the University of California and the Howard Hughes Medical Institute.}
00022 \textcolor{comment}{}
00023 \textcolor{comment}{All Rights Reserved.}
00024 \textcolor{comment}{}
00025 \textcolor{comment}{Permission to use, copy, modify, and distribute this software and its documentation for educational,
       research and }
00026 \textcolor{comment}{non-profit purposes, without fee, and without a written agreement is hereby granted, provided that the
       above copyright }
00027 \textcolor{comment}{notice, this paragraph and the following three paragraphs appear in all copies.}
00028 \textcolor{comment}{}
00029 \textcolor{comment}{Permission to incorporate this software into commercial products may be obtained by contacting the Office
       of }
00030 \textcolor{comment}{Technology Management at the University of California San Francisco [Sunita Rajdev, Ph.D., Licensing
       Officer, }
00031 \textcolor{comment}{UCSF Office of Technology Management. 185 Berry St, Suite 4603, San Francisco, CA 94107].}
00032 \textcolor{comment}{}
00033 \textcolor{comment}{This software program and documentation are copyrighted by The Regents of the University of California }
00034 \textcolor{comment}{acting on behalf of the University of California San Francisco via its Office of Technology Management and
       the }
00035 \textcolor{comment}{Howard Hughes Medical Institute (collectively, the Institution).  The software program and documentation
       are }
00036 \textcolor{comment}{supplied "as is", without any accompanying services from the Institution. The Institution does not warrant
       that the }
00037 \textcolor{comment}{operation of the program will be uninterrupted or error-free. The end-user understands that the program was
       developed }
00038 \textcolor{comment}{for research purposes and is advised not to rely exclusively on the program for any reason.}
00039 \textcolor{comment}{}
00040 \textcolor{comment}{IN NO EVENT SHALL THE INSTITUTION BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR
       CONSEQUENTIAL }
00041 \textcolor{comment}{DAMAGES, INCLUDING LOST PROFITS, ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF THE
       INSTITUTION }
00042 \textcolor{comment}{HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. THE  INSTITUTION SPECIFICALLY DISCLAIMS ANY WARRANTIES,
       INCLUDING, }
00043 \textcolor{comment}{BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE
       SOFTWARE }
00044 \textcolor{comment}{PROVIDED HEREUNDER IS ON AN "AS IS" BASIS, AND THE  INSTITUTION HAS NO OBLIGATIONS TO PROVIDE MAINTENANCE,
       SUPPORT, }
00045 \textcolor{comment}{UPDATES, ENHANCEMENTS, OR MODIFICATIONS.}
00046 \textcolor{comment}{*/}    
00047 
00048 \textcolor{keyword}{package }functions;
00049 
00050 \textcolor{keyword}{import} java.util.ArrayList;
00051 \textcolor{keyword}{import} java.util.List;
00052 \textcolor{keyword}{import} java.util.ListIterator;
00053 
00054 \textcolor{keyword}{import} \hyperlink{namespacedata}{data}.\hyperlink{classdata_1_1_params}{Params};
00055 \textcolor{keyword}{import} \hyperlink{namespacedata}{data}.\hyperlink{classdata_1_1_serializable_list}{SerializableList};
00056 \textcolor{keyword}{import} \hyperlink{namespacedata}{data}.\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon};
00057 \textcolor{keyword}{import} ij.IJ;
00058 \textcolor{keyword}{import} ij.ImagePlus;
00059 \textcolor{keyword}{import} ij.ImageStack;
00060 \textcolor{keyword}{import} ij.measure.Measurements;
00061 \textcolor{keyword}{import} ij.measure.ResultsTable;
00062 \textcolor{keyword}{import} ij.plugin.filter.ParticleAnalyzer;
00063 
\hypertarget{_video_recognition_8java_source_l00064}{}\hyperlink{classfunctions_1_1_video_recognition}{00064} \textcolor{keyword}{public} \textcolor{keyword}{class }\hyperlink{classfunctions_1_1_video_recognition}{VideoRecognition} \textcolor{keyword}{implements} Measurements \{
00065 
\hypertarget{_video_recognition_8java_source_l00066}{}\hyperlink{classfunctions_1_1_video_recognition_a7901d0cc46df7762032f67cd822e30a5}{00066}   \textcolor{keyword}{public} \hyperlink{classfunctions_1_1_video_recognition_a7901d0cc46df7762032f67cd822e30a5}{VideoRecognition}() \{\}
00067   
\hypertarget{_video_recognition_8java_source_l00073}{}\hyperlink{classfunctions_1_1_video_recognition_a5472ba1ca2aba8ebc35bcb63634421e1}{00073}   \textcolor{keyword}{public} \hyperlink{classdata_1_1_serializable_list}{SerializableList} \hyperlink{classfunctions_1_1_video_recognition_a5472ba1ca2aba8ebc35bcb63634421e1}{analyzeVideo}(ImagePlus imp) \{
00074     \textcolor{keywordflow}{if} (imp == null)
00075       \textcolor{keywordflow}{return} \textcolor{keyword}{new} \hyperlink{classdata_1_1_serializable_list}{SerializableList}();
00076     System.out.println(\textcolor{stringliteral}{"converToGrayScale..."});
00077     \hyperlink{classfunctions_1_1_computer_vision}{ComputerVision} cv = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_computer_vision}{ComputerVision}();
00078     cv.\hyperlink{classfunctions_1_1_computer_vision_a4d0fe516e9ef71c60ba67150cf288030}{convertToGrayscale}(imp);
00079     \textcolor{comment}{// ************************************************************}
00080     \textcolor{comment}{// * Automatic Thresholding}
00081     \textcolor{comment}{// ************************************************************}
00082     System.out.println(\textcolor{stringliteral}{"thresholdStack..."});
00083     cv.\hyperlink{classfunctions_1_1_computer_vision_a253912ee71e289051b50b08dcce6376f}{thresholdStack}(imp);
00084     \textcolor{comment}{// ************************************************************}
00085     \textcolor{comment}{// * Record particle positions for each frame in an ArrayList}
00086     \textcolor{comment}{// ************************************************************}
00087     System.out.println(\textcolor{stringliteral}{"detectSpermatozoa..."});
00088     List[] theParticles =  \hyperlink{classfunctions_1_1_video_recognition_a08fc1c8ff56553233cab77b1dea7b978}{detectSpermatozoa}(imp);
00089     \textcolor{comment}{// ************************************************************}
00090     \textcolor{comment}{// * Now assemble tracks out of the spermatozoa lists}
00091     \textcolor{comment}{// * Also record to which track a particle belongs in ArrayLists}
00092     \textcolor{comment}{// ************************************************************}
00093     System.out.println(\textcolor{stringliteral}{"identifyTracks..."});
00094     \hyperlink{classdata_1_1_serializable_list}{SerializableList} theTracks = \hyperlink{classfunctions_1_1_video_recognition_a31e3f4ea058db30f6dc0bd3d192d6b4b}{idenfityTracks}(theParticles, imp.
      getStackSize());
00095     \textcolor{comment}{// Filtering tracks by length}
00096     \hyperlink{classfunctions_1_1_signal_processing}{SignalProcessing} sp = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_signal_processing}{SignalProcessing}();
00097     theTracks = sp.filterTracksByLength(theTracks);
00098     \textcolor{comment}{// IJ.saveString(Utils.printXYCoords(theTracks),"");}
00099     \textcolor{keywordflow}{return} theTracks;
00100   \}  
00101   
00102   \textcolor{comment}{/******************************************************/}
\hypertarget{_video_recognition_8java_source_l00108}{}\hyperlink{classfunctions_1_1_video_recognition_a08fc1c8ff56553233cab77b1dea7b978}{00108}   \textcolor{keyword}{public} List[] \hyperlink{classfunctions_1_1_video_recognition_a08fc1c8ff56553233cab77b1dea7b978}{detectSpermatozoa}(ImagePlus imp) \{
00109 
00110     \textcolor{keywordtype}{int} nFrames = imp.getStackSize();
00111     ImageStack stack = imp.getStack();
00112     \textcolor{keywordtype}{int} options = 0; \textcolor{comment}{// set all PA options false}
00113     \textcolor{keywordtype}{int} measurements = MEAN + CENTROID + RECT + AREA + PERIMETER + FERET;
00114     \textcolor{comment}{// Initialize results table}
00115     ResultsTable rt = \textcolor{keyword}{new} ResultsTable();
00116     rt.reset();
00117     \textcolor{keywordtype}{int} minSize = (int) (\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a0aac8d82501e8bd6df290478d853662b}{minSize} * Math.pow((1 / \hyperlink{classdata_1_1_params}{Params}.
      \hyperlink{classdata_1_1_params_a19331ee97ef3c422984fc7dff976549e}{micronPerPixel}), 2));
00118     \textcolor{keywordtype}{int} maxSize = (int) (\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a7274c4f365a3b3d5e70f4c0e797684ac}{maxSize} * Math.pow((1 / \hyperlink{classdata_1_1_params}{Params}.
      \hyperlink{classdata_1_1_params_a19331ee97ef3c422984fc7dff976549e}{micronPerPixel}), 2));
00119     \textcolor{comment}{// create storage for Spermatozoa positions}
00120     List[] spermatozoa = \textcolor{keyword}{new} ArrayList[nFrames];
00121     \textcolor{comment}{// *************************************************************}
00122     \textcolor{comment}{// * Record spermatozoa positions for each frame in an ArrayList}
00123     \textcolor{comment}{// *************************************************************/}
00124     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} iFrame = 1; iFrame <= nFrames; iFrame++) \{
00125       IJ.showProgress((\textcolor{keywordtype}{double}) iFrame / nFrames);
00126       IJ.showStatus(\textcolor{stringliteral}{"Identifying spermatozoa per frame..."});      
00127       spermatozoa[iFrame - 1] = \textcolor{keyword}{new} ArrayList();
00128       rt.reset();
00129       ParticleAnalyzer pa = \textcolor{keyword}{new} ParticleAnalyzer(options, measurements, rt, minSize, maxSize);
00130       pa.analyze(imp, stack.getProcessor(iFrame));
00131       \textcolor{keywordtype}{float}[] sxRes = rt.getColumn(ResultsTable.X\_CENTROID);
00132       \textcolor{keywordtype}{float}[] syRes = rt.getColumn(ResultsTable.Y\_CENTROID);
00133       \textcolor{keywordtype}{float}[] bxRes = rt.getColumn(ResultsTable.ROI\_X);
00134       \textcolor{keywordtype}{float}[] byRes = rt.getColumn(ResultsTable.ROI\_Y);
00135       \textcolor{keywordtype}{float}[] widthRes = rt.getColumn(ResultsTable.ROI\_WIDTH);
00136       \textcolor{keywordtype}{float}[] heightRes = rt.getColumn(ResultsTable.ROI\_HEIGHT);
00137       \textcolor{keywordtype}{float}[] areaRes = rt.getColumn(ResultsTable.AREA);
00138       \textcolor{keywordtype}{float}[] perimeterRes = rt.getColumn(ResultsTable.PERIMETER);
00139       \textcolor{keywordtype}{float}[] feretRes = rt.getColumn(ResultsTable.FERET);
00140       \textcolor{keywordtype}{float}[] minFeretRes = rt.getColumn(ResultsTable.MIN\_FERET);
00141       \textcolor{keywordflow}{if} (sxRes == null) \textcolor{comment}{//Nothing detected}
00142         \textcolor{keywordflow}{continue};\textcolor{comment}{//jump to next frame}
00143       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} iPart = 0; iPart < sxRes.length; iPart++) \{
00144         \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} aSpermatozoon = \textcolor{keyword}{new} \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}();
00145         aSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_a76010eef1edc0406cc2375c25d2a433d}{id} = \textcolor{stringliteral}{"***"};
00146         aSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_ad0da36b2558901e21e7a30f6c227a45e}{x} = sxRes[iPart];
00147         aSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_aa4f0d3eebc3c443f9be81bf48561a217}{y} = syRes[iPart];
00148         aSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_a14f94e529dff0b8bfba8e16fbe9755d6}{z} = iFrame - 1;
00149         aSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_a5c25ae7634a79d11d6679b6b07c240a1}{bx} = bxRes[iPart];
00150         aSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_affce45e955f0a114a5569e019b8d8634}{by} = byRes[iPart];
00151         aSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_ae426f00e82704fa09578f5446e22d915}{width} = widthRes[iPart];
00152         aSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_a48083b65ac9a863566dc3e3fff09a5b4}{height} = heightRes[iPart];
00153         aSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_ac84d85b9355bdffd37cf8632c9f72efe}{total\_area} = areaRes[iPart];
00154         aSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_a893cd9ee5a9bdc16eecb9891fadd602c}{total\_perimeter} = perimeterRes[iPart];
00155         aSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_ab5ab64dc3696466f1e700d20d538e436}{total\_feret} = feretRes[iPart];
00156         aSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_aea69b99de4cd3bda1fc7c464bb5d842e}{total\_minFeret} = minFeretRes[iPart];
00157         spermatozoa[iFrame - 1].add(aSpermatozoon);
00158       \}
00159     \}
00160     \textcolor{keywordflow}{return} spermatozoa;
00161   \}
00162   \textcolor{comment}{/******************************************************/}
\hypertarget{_video_recognition_8java_source_l00169}{}\hyperlink{classfunctions_1_1_video_recognition_a31e3f4ea058db30f6dc0bd3d192d6b4b}{00169}   \textcolor{keyword}{public} \hyperlink{classdata_1_1_serializable_list}{SerializableList} \hyperlink{classfunctions_1_1_video_recognition_a31e3f4ea058db30f6dc0bd3d192d6b4b}{idenfityTracks}(List[] spermatozoa, \textcolor{keywordtype}{int} nFrames) \{
00170 
00171     \textcolor{comment}{// int nFrames = imp.getStackSize();}
00172     \hyperlink{classdata_1_1_serializable_list}{SerializableList} theTracks = \textcolor{keyword}{new} \hyperlink{classdata_1_1_serializable_list}{SerializableList}();
00173     \textcolor{keywordtype}{int} trackCount = 0;
00174     \textcolor{keywordflow}{if}(spermatozoa == null)
00175       \textcolor{keywordflow}{return} theTracks;
00176     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i <= (nFrames - 1); i++) \{
00177       IJ.showProgress((\textcolor{keywordtype}{double}) i / nFrames);
00178       IJ.showStatus(\textcolor{stringliteral}{"Calculating Tracks..."});
00179       \textcolor{keywordflow}{if}(spermatozoa[i] == null)\textcolor{comment}{//no spermatozoa detected in frame i}
00180         \textcolor{keywordflow}{continue}; \textcolor{comment}{//jump to next frame}
00181       \textcolor{keywordflow}{for} (ListIterator j = spermatozoa[i].listIterator(); j.hasNext();) \{
00182         \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} aSpermatozoon = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) j.next();
00183         \textcolor{keywordflow}{if} (!aSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_a204be1963f7e7f07114c1d42360376be}{inTrack}) \{
00184           \textcolor{comment}{// This must be the beginning of a new track}
00185           List aTrack = \textcolor{keyword}{new} ArrayList();
00186           trackCount++;
00187           aSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_a204be1963f7e7f07114c1d42360376be}{inTrack} = \textcolor{keyword}{true};
00188           aSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_aee0b3af79335b49fe9d9b025cfcde703}{trackNr} = trackCount;
00189           aTrack.add(aSpermatozoon);
00190           \textcolor{comment}{// *************************************************************}
00191           \textcolor{comment}{// search in next frames for more Spermatozoa to be added to}
00192           \textcolor{comment}{// track}
00193           \textcolor{comment}{// *************************************************************}
00194           \textcolor{keywordtype}{boolean} searchOn = \textcolor{keyword}{true};
00195           \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} oldSpermatozoon = \textcolor{keyword}{new} \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}();
00196           \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} tmpSpermatozoon = \textcolor{keyword}{new} \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}();
00197           oldSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_ac4622d389badba1a387ec1e139d35c8e}{copy}(aSpermatozoon);
00198           \textcolor{comment}{// *}
00199           \textcolor{comment}{// * For each frame}
00200           \textcolor{comment}{// *}
00201           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} iF = i + 1; iF <= (nFrames - 1); iF++) \{
00202             \textcolor{keywordtype}{boolean} foundOne = \textcolor{keyword}{false};
00203             \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} newSpermatozoon = \textcolor{keyword}{new} \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}();
00204             \textcolor{comment}{// *}
00205             \textcolor{comment}{// * For each Spermatozoon in this frame}
00206             \textcolor{comment}{// *}
00207             \textcolor{keywordflow}{for} (ListIterator jF = spermatozoa[iF].listIterator(); jF.hasNext() && searchOn;) \{
00208               \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} testSpermatozoon = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) jF.next();
00209               \textcolor{keywordtype}{float} distance = testSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_aaef7a8e7602a08c82ea5fcbb777883e0}{distance}(oldSpermatozoon);
00210               \textcolor{comment}{// record a Spermatozoon when it is within the search}
00211               \textcolor{comment}{// radius, and when it had not yet been claimed by another}
00212               \textcolor{comment}{// track}
00213               \textcolor{keywordflow}{if} ((distance < (\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_ab28f784a26ca9d2ce7d7a785b158aa61}{maxDisplacement} / 
      \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a19331ee97ef3c422984fc7dff976549e}{micronPerPixel})) && !testSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_a204be1963f7e7f07114c1d42360376be}{inTrack}) \{
00214                 \textcolor{comment}{// if we had not found a Spermatozoon before, it is easy}
00215                 \textcolor{keywordflow}{if} (!foundOne) \{
00216                   tmpSpermatozoon = testSpermatozoon;
00217                   testSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_a204be1963f7e7f07114c1d42360376be}{inTrack} = \textcolor{keyword}{true};
00218                   testSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_aee0b3af79335b49fe9d9b025cfcde703}{trackNr} = trackCount;
00219                   newSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_ac4622d389badba1a387ec1e139d35c8e}{copy}(testSpermatozoon);
00220                   foundOne = \textcolor{keyword}{true};
00221                 \} \textcolor{keywordflow}{else} \{
00222                   \textcolor{comment}{// if we had one before, we'll take this one if it is}
00223                   \textcolor{comment}{// closer. In any case, flag these Spermatozoa}
00224                   testSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_ab46c49fb62e0ee61b3865f1e9153fdaa}{flag} = \textcolor{keyword}{true};
00225                   \textcolor{keywordflow}{if} (distance < newSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_aaef7a8e7602a08c82ea5fcbb777883e0}{distance}(oldSpermatozoon)) \{
00226                     testSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_a204be1963f7e7f07114c1d42360376be}{inTrack} = \textcolor{keyword}{true};
00227                     testSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_aee0b3af79335b49fe9d9b025cfcde703}{trackNr} = trackCount;
00228                     newSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_ac4622d389badba1a387ec1e139d35c8e}{copy}(testSpermatozoon);
00229                     tmpSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_a204be1963f7e7f07114c1d42360376be}{inTrack} = \textcolor{keyword}{false};
00230                     tmpSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_aee0b3af79335b49fe9d9b025cfcde703}{trackNr} = 0;
00231                     tmpSpermatozoon = testSpermatozoon;
00232                   \} \textcolor{keywordflow}{else} \{
00233                     newSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_ab46c49fb62e0ee61b3865f1e9153fdaa}{flag} = \textcolor{keyword}{true};
00234                   \}
00235                 \}
00236               \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (distance < (\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_ab28f784a26ca9d2ce7d7a785b158aa61}{maxDisplacement} / 
      \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a19331ee97ef3c422984fc7dff976549e}{micronPerPixel})) \{
00237                 \textcolor{comment}{// this Spermatozoon is already in another track but}
00238                 \textcolor{comment}{// could have been part of this one}
00239                 \textcolor{comment}{// We have a number of choices here:}
00240                 \textcolor{comment}{// 1. Sort out to which track this Spermatozoon really}
00241                 \textcolor{comment}{// belongs (but how?)}
00242                 \textcolor{comment}{// 2. Stop this track}
00243                 \textcolor{comment}{// 3. Stop this track, and also delete the remainder of}
00244                 \textcolor{comment}{// the other one}
00245                 \textcolor{comment}{// 4. Stop this track and flag this Spermatozoon:}
00246                 testSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_ab46c49fb62e0ee61b3865f1e9153fdaa}{flag} = \textcolor{keyword}{true};
00247               \}
00248             \}
00249             \textcolor{keywordflow}{if} (foundOne)
00250               aTrack.add(newSpermatozoon);
00251             \textcolor{keywordflow}{else}
00252               searchOn = \textcolor{keyword}{false};
00253             oldSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_ac4622d389badba1a387ec1e139d35c8e}{copy}(newSpermatozoon);
00254           \}
00255           theTracks.add(aTrack);
00256         \}
00257       \}
00258     \}
00259     \textcolor{keywordflow}{return} theTracks;
00260   \}  
00261 
00262 \}
\end{DoxyCode}
