\hypertarget{_motility_8java_source}{}\section{Motility.\+java}
\label{_motility_8java_source}\index{Motility.\+java@{Motility.\+java}}

\begin{DoxyCode}
00001 \textcolor{comment}{/*}
00002 \textcolor{comment}{ *   OpenCASA software v0.8 for video and image analysis}
00003 \textcolor{comment}{ *   Copyright (C) 2017  Carlos Alqu√©zar}
00004 \textcolor{comment}{ *}
00005 \textcolor{comment}{ *   This program is free software: you can redistribute it and/or modify}
00006 \textcolor{comment}{ *   it under the terms of the GNU General Public License as published by}
00007 \textcolor{comment}{ *   the Free Software Foundation, either version 3 of the License, or}
00008 \textcolor{comment}{ *   (at your option) any later version.}
00009 \textcolor{comment}{ *}
00010 \textcolor{comment}{ *   This program is distributed in the hope that it will be useful,}
00011 \textcolor{comment}{ *   but WITHOUT ANY WARRANTY; without even the implied warranty of}
00012 \textcolor{comment}{ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00013 \textcolor{comment}{ *   GNU General Public License for more details.}
00014 \textcolor{comment}{ *}
00015 \textcolor{comment}{ *   You should have received a copy of the GNU General Public License}
00016 \textcolor{comment}{ *   along with this program.  If not, see <https://www.gnu.org/licenses/>.}
00017 \textcolor{comment}{*/}      
00018 
00019 \textcolor{keyword}{package }analysis;
00020 
00021 \textcolor{keyword}{import} java.util.HashMap;
00022 \textcolor{keyword}{import} java.util.List;
00023 \textcolor{keyword}{import} java.util.ListIterator;
00024 \textcolor{keyword}{import} java.util.Map;
00025 
00026 \textcolor{keyword}{import} javax.swing.SwingWorker;
00027 
00028 \textcolor{keyword}{import} \hyperlink{namespacedata}{data}.\hyperlink{classdata_1_1_params}{Params};
00029 \textcolor{keyword}{import} \hyperlink{namespacedata}{data}.\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon};
00030 \textcolor{keyword}{import} \hyperlink{namespacedata}{data}.\hyperlink{classdata_1_1_trial}{Trial};
00031 \textcolor{keyword}{import} \hyperlink{namespacefunctions}{functions}.\hyperlink{classfunctions_1_1_file_manager}{FileManager};
00032 \textcolor{keyword}{import} \hyperlink{namespacefunctions}{functions}.\hyperlink{classfunctions_1_1_kinematics}{Kinematics};
00033 \textcolor{keyword}{import} \hyperlink{namespacefunctions}{functions}.\hyperlink{classfunctions_1_1_paint}{Paint};
00034 \textcolor{keyword}{import} \hyperlink{namespacefunctions}{functions}.\hyperlink{classfunctions_1_1_signal_processing}{SignalProcessing};
00035 \textcolor{keyword}{import} \hyperlink{namespacefunctions}{functions}.\hyperlink{classfunctions_1_1_trial_manager}{TrialManager};
00036 \textcolor{keyword}{import} \hyperlink{namespacefunctions}{functions}.\hyperlink{classfunctions_1_1_utils}{Utils};
00037 \textcolor{keyword}{import} ij.IJ;
00038 \textcolor{keyword}{import} ij.ImagePlus;
00039 \textcolor{keyword}{import} ij.measure.ResultsTable;
00040 
\hypertarget{_motility_8java_source_l00046}{}\hyperlink{classanalysis_1_1_motility}{00046} \textcolor{keyword}{public} \textcolor{keyword}{class }\hyperlink{classanalysis_1_1_motility}{Motility} \textcolor{keyword}{extends} SwingWorker<Boolean, String> \{
00047 
\hypertarget{_motility_8java_source_l00048}{}\hyperlink{enumanalysis_1_1_motility_1_1_type_of_analysis}{00048}   \textcolor{keyword}{private} \textcolor{keyword}{enum} \hyperlink{enumanalysis_1_1_motility_1_1_type_of_analysis}{TypeOfAnalysis} \{
\hypertarget{_motility_8java_source_l00049}{}\hyperlink{enumanalysis_1_1_motility_1_1_type_of_analysis_a899caa602e4fff675b17cdbab33607ec}{00049}     DIRECTORIES, DIRECTORY, FILE, NONE
00050   \}
00051 
\hypertarget{_motility_8java_source_l00052}{}\hyperlink{classanalysis_1_1_motility_ae0c6f15cfb3c589fb7817738e51998bd}{00052}   \textcolor{keyword}{private} \hyperlink{enumanalysis_1_1_motility_1_1_type_of_analysis}{TypeOfAnalysis} \hyperlink{namespaceanalysis}{analysis}              = 
      \hyperlink{enumanalysis_1_1_motility_1_1_type_of_analysis}{TypeOfAnalysis}.\hyperlink{enumanalysis_1_1_motility_1_1_type_of_analysis_a899caa602e4fff675b17cdbab33607ec}{NONE};
\hypertarget{_motility_8java_source_l00053}{}\hyperlink{classanalysis_1_1_motility_a4781116c1a5f8316e2cacb2e92dac270}{00053}   \textcolor{keyword}{private} \textcolor{keywordtype}{float}          \hyperlink{classanalysis_1_1_motility_a4781116c1a5f8316e2cacb2e92dac270}{countProgressiveSperm} = 0;
\hypertarget{_motility_8java_source_l00054}{}\hyperlink{classanalysis_1_1_motility_a35f4543589a6af76e2ba8e813e9c8d15}{00054}   \textcolor{keyword}{private} \textcolor{keywordtype}{float}          \hyperlink{classanalysis_1_1_motility_a35f4543589a6af76e2ba8e813e9c8d15}{total\_alhMax}          = 0;
\hypertarget{_motility_8java_source_l00055}{}\hyperlink{classanalysis_1_1_motility_a85064380da24660107d26a563b17e002}{00055}   \textcolor{keyword}{private} \textcolor{keywordtype}{float}          \hyperlink{classanalysis_1_1_motility_a85064380da24660107d26a563b17e002}{total\_alhMean}         = 0;
\hypertarget{_motility_8java_source_l00056}{}\hyperlink{classanalysis_1_1_motility_aa42afc6b771762a4c51d2ac098050a2c}{00056}   \textcolor{keyword}{private} \textcolor{keywordtype}{float}          \hyperlink{classanalysis_1_1_motility_aa42afc6b771762a4c51d2ac098050a2c}{total\_bcf}             = 0;
\hypertarget{_motility_8java_source_l00057}{}\hyperlink{classanalysis_1_1_motility_aac49177d1bc39508a93db152eb8f8c61}{00057}   \textcolor{keyword}{private} \textcolor{keywordtype}{float}          \hyperlink{classanalysis_1_1_motility_aac49177d1bc39508a93db152eb8f8c61}{total\_dance}           = 0;
\hypertarget{_motility_8java_source_l00058}{}\hyperlink{classanalysis_1_1_motility_a051b97e22d0b6acb0d861dd7e4e26f94}{00058}   \textcolor{keyword}{private} \textcolor{keywordtype}{float}          \hyperlink{classanalysis_1_1_motility_a051b97e22d0b6acb0d861dd7e4e26f94}{total\_lin}             = 0;
\hypertarget{_motility_8java_source_l00059}{}\hyperlink{classanalysis_1_1_motility_a5c428e4bdee1a7aa6c30ce2789a781db}{00059}   \textcolor{keyword}{private} \textcolor{keywordtype}{float}          \hyperlink{classanalysis_1_1_motility_a5c428e4bdee1a7aa6c30ce2789a781db}{total\_mad}             = 0;
\hypertarget{_motility_8java_source_l00060}{}\hyperlink{classanalysis_1_1_motility_aec24fedb6d4751dbc92852b6b7c467f4}{00060}   \textcolor{keyword}{private} \textcolor{keywordtype}{float}          \hyperlink{classanalysis_1_1_motility_aec24fedb6d4751dbc92852b6b7c467f4}{total\_motile}          = 0;
\hypertarget{_motility_8java_source_l00061}{}\hyperlink{classanalysis_1_1_motility_a12c018b723047f29c67110a7bb1134a8}{00061}   \textcolor{keyword}{private} \textcolor{keywordtype}{float}          \hyperlink{classanalysis_1_1_motility_a12c018b723047f29c67110a7bb1134a8}{total\_nonMotile}       = 0;
\hypertarget{_motility_8java_source_l00062}{}\hyperlink{classanalysis_1_1_motility_a2815eaed86c0b1e82e0fa050070546de}{00062}   \textcolor{keyword}{private} \textcolor{keywordtype}{float}          \hyperlink{classanalysis_1_1_motility_a2815eaed86c0b1e82e0fa050070546de}{total\_sperm}           = 0;
\hypertarget{_motility_8java_source_l00063}{}\hyperlink{classanalysis_1_1_motility_ae849455f41cc53bf86d72ca509155a83}{00063}   \textcolor{keyword}{private} \textcolor{keywordtype}{float}          \hyperlink{classanalysis_1_1_motility_ae849455f41cc53bf86d72ca509155a83}{total\_str}             = 0;
\hypertarget{_motility_8java_source_l00064}{}\hyperlink{classanalysis_1_1_motility_ae4d5fa9ba9511057ab1b12594029ebd5}{00064}   \textcolor{keyword}{private} \textcolor{keywordtype}{float}          \hyperlink{classanalysis_1_1_motility_ae4d5fa9ba9511057ab1b12594029ebd5}{total\_vap}             = 0;
\hypertarget{_motility_8java_source_l00065}{}\hyperlink{classanalysis_1_1_motility_a39e3cc2644471738bffd77164ecefa1a}{00065}   \textcolor{keyword}{private} \textcolor{keywordtype}{float}          \hyperlink{classanalysis_1_1_motility_a39e3cc2644471738bffd77164ecefa1a}{total\_vcl}             = 0;
\hypertarget{_motility_8java_source_l00066}{}\hyperlink{classanalysis_1_1_motility_a9fca6ddbc4e27eaf9181320d32dbd631}{00066}   \textcolor{keyword}{private} \textcolor{keywordtype}{float}          \hyperlink{classanalysis_1_1_motility_a9fca6ddbc4e27eaf9181320d32dbd631}{total\_vsl}             = 0;
\hypertarget{_motility_8java_source_l00067}{}\hyperlink{classanalysis_1_1_motility_a8884d2acf5fc9ed45c9b8d775da894ce}{00067}   \textcolor{keyword}{private} \textcolor{keywordtype}{float}          \hyperlink{classanalysis_1_1_motility_a8884d2acf5fc9ed45c9b8d775da894ce}{total\_wob}             = 0;
00068 
\hypertarget{_motility_8java_source_l00069}{}\hyperlink{classanalysis_1_1_motility_a7c749f31bb24070f3cb6e9133160eb34}{00069}   \textcolor{keyword}{public} \hyperlink{classanalysis_1_1_motility_a7c749f31bb24070f3cb6e9133160eb34}{Motility}() \{
00070   \}
00071 
\hypertarget{_motility_8java_source_l00078}{}\hyperlink{classanalysis_1_1_motility_ab3d086d15d667db78ea6785d8fc90223}{00078}   \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{classanalysis_1_1_motility_ab3d086d15d667db78ea6785d8fc90223}{analyseDirectories}() \{
00079     \hyperlink{classfunctions_1_1_file_manager}{FileManager} fm = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_file_manager}{FileManager}();
00080     String folder = fm.\hyperlink{classfunctions_1_1_file_manager_af19fd6734ccb746c4f276c83b6a47689}{selectFolder}();
00081     List<String> subfolders = fm.\hyperlink{classfunctions_1_1_file_manager_a73efd872c86ccdce535ddb2798aaaea4}{getSubfolders}(folder);
00082     ResultsTable rtTotal = \textcolor{keyword}{new} ResultsTable();
00083     \textcolor{keywordtype}{int} i = 0;
00084     \textcolor{keywordflow}{for} (String s : subfolders) \{
00085       IJ.showProgress((\textcolor{keywordtype}{double}) i / subfolders.size());
00086       IJ.showStatus(\textcolor{stringliteral}{"Analizing folder "} + i++ + \textcolor{stringliteral}{"..."});
00087       List<String> files = fm.\hyperlink{classfunctions_1_1_file_manager_a3a54a5574abfddd928b2b8675e8affa6}{getFiles}(s);
00088       Map<String, Trial> trials = \hyperlink{classanalysis_1_1_motility_a5580224f7f7e9df7d925ad14f9364d98}{getTrials}(files);
00089       \textcolor{keywordflow}{for} (String key : trials.keySet()) \{
00090         \hyperlink{classdata_1_1_trial}{Trial} trial = (\hyperlink{classdata_1_1_trial}{Trial}) trials.get(key);
00091         \textcolor{comment}{// Motility results}
00092         \hyperlink{classanalysis_1_1_motility_a02cd8027747b70728a837c58fdf75cb4}{calculateMotility}(\textcolor{keyword}{new} ResultsTable(), trial);
00093         \hyperlink{classanalysis_1_1_motility_afa983ea070fe9739c16c819bd180dac9}{calculateAverageMotility}(\textcolor{keyword}{new} ResultsTable(), trial);
00094       \}
00095       \hyperlink{classanalysis_1_1_motility_a6416a16af8e55569f37168bb76fe7174}{calculateTotalMotility}(rtTotal, s);
00096       \hyperlink{classanalysis_1_1_motility_a20915c32899c4bbe4d08e483bd5eb09c}{resetParams}();
00097     \}
00098     rtTotal.show(\textcolor{stringliteral}{"Total Motility"});
00099   \}
00100 
\hypertarget{_motility_8java_source_l00107}{}\hyperlink{classanalysis_1_1_motility_ad8447fb7554f7f126822c7a3f3f680ce}{00107}   \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{classanalysis_1_1_motility_ad8447fb7554f7f126822c7a3f3f680ce}{analyseDirectory}() \{
00108     \hyperlink{classfunctions_1_1_file_manager}{FileManager} fm = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_file_manager}{FileManager}();
00109     String folder = fm.\hyperlink{classfunctions_1_1_file_manager_af19fd6734ccb746c4f276c83b6a47689}{selectFolder}();
00110     List<String> files = fm.\hyperlink{classfunctions_1_1_file_manager_a3a54a5574abfddd928b2b8675e8affa6}{getFiles}(folder);
00111     Map<String, Trial> trials = \hyperlink{classanalysis_1_1_motility_a5580224f7f7e9df7d925ad14f9364d98}{getTrials}(files);
00112     ResultsTable rtIndividual = \textcolor{keyword}{new} ResultsTable();
00113     ResultsTable rtAverage = \textcolor{keyword}{new} ResultsTable();
00114     \textcolor{keywordflow}{for} (String key : trials.keySet()) \{
00115       \hyperlink{classdata_1_1_trial}{Trial} trial = (\hyperlink{classdata_1_1_trial}{Trial}) trials.get(key);
00116       \textcolor{comment}{// Motility results}
00117       \hyperlink{classanalysis_1_1_motility_a02cd8027747b70728a837c58fdf75cb4}{calculateMotility}(rtIndividual, trial);
00118       \hyperlink{classanalysis_1_1_motility_afa983ea070fe9739c16c819bd180dac9}{calculateAverageMotility}(rtAverage, trial);
00119       \hyperlink{classanalysis_1_1_motility_a20915c32899c4bbe4d08e483bd5eb09c}{resetParams}();
00120     \}
00121     rtIndividual.show(\textcolor{stringliteral}{"Individual motility"});
00122     rtAverage.show(\textcolor{stringliteral}{"Average motility"});
00123   \}
00124 
\hypertarget{_motility_8java_source_l00129}{}\hyperlink{classanalysis_1_1_motility_a0b1464e818c4300782cb7e3322448f95}{00129}   \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{classanalysis_1_1_motility_a0b1464e818c4300782cb7e3322448f95}{analyseFile}() \{
00130     \hyperlink{classfunctions_1_1_file_manager}{FileManager} fm = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_file_manager}{FileManager}();
00131     String file = fm.\hyperlink{classfunctions_1_1_file_manager_aa741a9e7ac4127ae1a463fb626474edf}{selectFile}();
00132     \hyperlink{classfunctions_1_1_trial_manager}{TrialManager} tm = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_trial_manager}{TrialManager}();
00133     \hyperlink{classdata_1_1_trial}{Trial} trial = tm.\hyperlink{classfunctions_1_1_trial_manager_a5d815ce30de28983d08c22c909562e11}{getTrialFromAVI}(file);
00134     \textcolor{comment}{// Calculate motility}
00135     ResultsTable rtIndividual = \textcolor{keyword}{new} ResultsTable();
00136     ResultsTable rtAverage = \textcolor{keyword}{new} ResultsTable();
00137     \hyperlink{classanalysis_1_1_motility_a02cd8027747b70728a837c58fdf75cb4}{calculateMotility}(rtIndividual, trial);
00138     \hyperlink{classanalysis_1_1_motility_afa983ea070fe9739c16c819bd180dac9}{calculateAverageMotility}(rtAverage, trial);
00139     \textcolor{comment}{// Show results}
00140     rtIndividual.show(\textcolor{stringliteral}{"Individual Motility"});
00141     rtAverage.show(\textcolor{stringliteral}{"Average Motility"});
00142     \textcolor{comment}{// Draw trajectories}
00143     ImagePlus imp = fm.\hyperlink{classfunctions_1_1_file_manager_a140fc635f053a614aecddfb79baf5905}{getAVI}(file);
00144     \hyperlink{classfunctions_1_1_paint}{Paint} paint = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_paint}{Paint}();
00145     paint.\hyperlink{classfunctions_1_1_paint_a86f95f4ee27f7ce9ab517f4e322c9612}{draw}(imp, trial.\hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks});
00146     imp.show();
00147     \textcolor{keywordflow}{if}(\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_ae8b85275ab9c5375a3d35dcb7cd8332f}{printXY})\{
00148       \hyperlink{classfunctions_1_1_utils}{Utils} utils = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_utils}{Utils}();
00149       IJ.saveString(utils.\hyperlink{classfunctions_1_1_utils_ab85218da3569b5a7c0b9749e7b2b747a}{printXYCoords}(trial.\hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks}),\textcolor{stringliteral}{""});
00150     \}
00151   \}
00152 
\hypertarget{_motility_8java_source_l00161}{}\hyperlink{classanalysis_1_1_motility_afa983ea070fe9739c16c819bd180dac9}{00161}   \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{classanalysis_1_1_motility_afa983ea070fe9739c16c819bd180dac9}{calculateAverageMotility}(ResultsTable rt, 
      \hyperlink{classdata_1_1_trial}{Trial} trial) \{
00162 
00163     \hyperlink{classfunctions_1_1_signal_processing}{SignalProcessing} sp = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_signal_processing}{SignalProcessing}();
00164     List<List<Spermatozoon>> filteredTracks = sp.\hyperlink{classfunctions_1_1_signal_processing_a7302e4cf91bc23463aa9354325d2993d}{filterTracksByMotility}(trial.
      \hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks});
00165     \textcolor{keywordtype}{float} nTracks = filteredTracks.size(); \textcolor{comment}{// Only take into account those who passed the motility test}
00166     \textcolor{keywordtype}{float} vsl\_mean = total\_vsl / nTracks;
00167     \textcolor{keywordtype}{float} vcl\_mean = total\_vcl / nTracks;
00168     \textcolor{keywordtype}{float} vap\_mean = total\_vap / nTracks;
00169     \textcolor{keywordtype}{float} lin\_mean = total\_lin / nTracks;
00170     \textcolor{keywordtype}{float} wob\_mean = total\_wob / nTracks;
00171     \textcolor{keywordtype}{float} str\_mean = total\_str / nTracks;
00172     \textcolor{keywordtype}{float} alhMean\_mean = total\_alhMean / nTracks;
00173     \textcolor{keywordtype}{float} alhMax\_mean = total\_alhMax / nTracks;
00174     \textcolor{keywordtype}{float} bcf\_mean = total\_bcf / nTracks;
00175     \textcolor{keywordtype}{float} dance\_mean = total\_dance / nTracks;
00176     \textcolor{keywordtype}{float} mad\_mean = total\_mad / nTracks;
00177     \textcolor{comment}{// % progressive Motile sperm}
00178     \textcolor{keywordtype}{float} progressiveMotPercent = countProgressiveSperm / (float) nTracks;
00179     \textcolor{comment}{// % motility}
00180     \hyperlink{classfunctions_1_1_kinematics}{Kinematics} K = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_kinematics}{Kinematics}();
00181     \textcolor{keywordtype}{int}[] motileSperm = K.\hyperlink{classfunctions_1_1_kinematics_a5dbef047c19d4c554b08ba879eb7443f}{motilityTest}(trial.\hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks});
00182     \textcolor{keywordtype}{int} countMotileSperm = motileSperm[0];
00183     total\_motile += countMotileSperm;
00184     \textcolor{keywordtype}{int} countNonMotileSperm = motileSperm[1];
00185     total\_nonMotile += countNonMotileSperm;
00186     \textcolor{keywordtype}{float} motility\_value = (float) countMotileSperm / ((\textcolor{keywordtype}{float}) (countMotileSperm + countNonMotileSperm));
00187     total\_sperm += nTracks;
00188 
00189     rt.incrementCounter();
00190     rt.addValue(\textcolor{stringliteral}{"Motile trajectories"}, nTracks);
00191     rt.addValue(\textcolor{stringliteral}{"VSL Mean (um/s)"}, vsl\_mean);
00192     rt.addValue(\textcolor{stringliteral}{"VCL Mean (um/s)"}, vcl\_mean);
00193     rt.addValue(\textcolor{stringliteral}{"VAP Mean (um/s)"}, vap\_mean);
00194     rt.addValue(\textcolor{stringliteral}{"LIN Mean "}, lin\_mean);
00195     rt.addValue(\textcolor{stringliteral}{"WOB Mean "}, wob\_mean);
00196     rt.addValue(\textcolor{stringliteral}{"STR Mean "}, str\_mean);
00197     rt.addValue(\textcolor{stringliteral}{"ALH\_Mean Mean (um)"}, alhMean\_mean);
00198     rt.addValue(\textcolor{stringliteral}{"ALH\_Max Mean (um)"}, alhMax\_mean);
00199     rt.addValue(\textcolor{stringliteral}{"BCF Mean (Hz)"}, bcf\_mean);
00200     rt.addValue(\textcolor{stringliteral}{"DANCE Mean (um^2/s)"}, dance\_mean);
00201     rt.addValue(\textcolor{stringliteral}{"MAD Mean (degrees)"}, mad\_mean);
00202     rt.addValue(\textcolor{stringliteral}{"Progressive Motility (%)"}, progressiveMotPercent * 100);
00203     rt.addValue(\textcolor{stringliteral}{"Motility (%)"}, motility\_value * 100);
00204     rt.addValue(\textcolor{stringliteral}{"Sample"}, trial.\hyperlink{classdata_1_1_trial_a0b86e44425dbe3c9d866aa273f87828a}{type});
00205     rt.addValue(\textcolor{stringliteral}{"ID"}, trial.\hyperlink{classdata_1_1_trial_a317298c3409575f71e43acd3f73ce295}{ID});
00206     rt.addValue(\textcolor{stringliteral}{"Source"}, trial.\hyperlink{classdata_1_1_trial_a00baeba9d13a88ce01098a02d1e570d5}{source});
00207     \textcolor{keywordflow}{if} (!\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a3e07114fb70a676dfe24fad6be8c3c75}{male}.isEmpty())
00208       rt.addValue(\textcolor{stringliteral}{"Male"}, \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a3e07114fb70a676dfe24fad6be8c3c75}{male});
00209     \textcolor{keywordflow}{if} (!\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_aecbab8174a6d72649883508cf9940d58}{date}.isEmpty())
00210       rt.addValue(\textcolor{stringliteral}{"Date"}, \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_aecbab8174a6d72649883508cf9940d58}{date});
00211     \textcolor{keywordflow}{if} (!\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a253e4e926c0399ed1ae42b5a5989824d}{genericField}.isEmpty())
00212       rt.addValue(\textcolor{stringliteral}{"Generic Field"}, \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a253e4e926c0399ed1ae42b5a5989824d}{genericField});
00213   \}
00214 
\hypertarget{_motility_8java_source_l00223}{}\hyperlink{classanalysis_1_1_motility_a02cd8027747b70728a837c58fdf75cb4}{00223}   \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{classanalysis_1_1_motility_a02cd8027747b70728a837c58fdf75cb4}{calculateMotility}(ResultsTable rt, \hyperlink{classdata_1_1_trial}{Trial} trial) \{
00224 
00225     \hyperlink{classfunctions_1_1_signal_processing}{SignalProcessing} sp = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_signal_processing}{SignalProcessing}();
00226     \hyperlink{classfunctions_1_1_kinematics}{Kinematics} K = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_kinematics}{Kinematics}();
00227     \textcolor{comment}{// Only pass from here tracks with a minimum level of motility}
00228     List<List<Spermatozoon>> filteredTracks = sp.\hyperlink{classfunctions_1_1_signal_processing_a7302e4cf91bc23463aa9354325d2993d}{filterTracksByMotility}(trial.
      \hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks});
00229     \textcolor{comment}{// Calculate values for each track}
00230     \textcolor{keywordflow}{for} (ListIterator iT = filteredTracks.listIterator(); iT.hasNext();) \{
00231       List aTrack = (List) iT.next();
00232       List avgTrack = sp.\hyperlink{classfunctions_1_1_signal_processing_a4f10245c50d850b87d1ef4d81c28300d}{movingAverage}(aTrack);
00233       \textcolor{keywordtype}{float} length = (float) aTrack.size();
00234       \textcolor{comment}{// VSL}
00235       \textcolor{keywordtype}{float} vsl\_value = K.\hyperlink{classfunctions_1_1_kinematics_a938c4a9daa152f426259a01bc6654b25}{vsl}(aTrack);
00236       total\_vsl += vsl\_value;
00237       \textcolor{comment}{// VCL}
00238       \textcolor{keywordtype}{float} vcl\_value = K.\hyperlink{classfunctions_1_1_kinematics_af6e1e75567a927a9c627616cb68b0d7f}{vcl}(aTrack);
00239       total\_vcl += vcl\_value;
00240       \textcolor{comment}{// VAP is equivalent to calculate vcl from averaged track}
00241       \textcolor{keywordtype}{float} vap\_value = K.\hyperlink{classfunctions_1_1_kinematics_af6e1e75567a927a9c627616cb68b0d7f}{vcl}(avgTrack);
00242       total\_vap += vap\_value;
00243       \textcolor{comment}{// Linearity}
00244       \textcolor{keywordtype}{float} lin\_value = (vsl\_value / vcl\_value) * 100;
00245       total\_lin += lin\_value;
00246       \textcolor{comment}{// Wobble}
00247       \textcolor{keywordtype}{float} wob\_value = (vap\_value / vcl\_value) * 100;
00248       total\_wob += wob\_value;
00249       \textcolor{comment}{// Straightness}
00250       \textcolor{keywordtype}{float} str\_value = (vsl\_value / vap\_value) * 100;
00251       total\_str += str\_value;
00252       \textcolor{comment}{// Amplitude of lateral head}
00253       \textcolor{keywordtype}{float}[] alh\_values = K.\hyperlink{classfunctions_1_1_kinematics_a8f8221f314e814927fb192ea65f2af4a}{alh}(aTrack, avgTrack);
00254       total\_alhMean += alh\_values[0];
00255       total\_alhMax += alh\_values[1];
00256       \textcolor{comment}{// Beat-cross frequency}
00257       \textcolor{keywordtype}{float} bcf\_value = K.\hyperlink{classfunctions_1_1_kinematics_ac35b9a912f923321eee5335c011f7c89}{bcf}(aTrack, avgTrack);
00258       total\_bcf += bcf\_value;
00259       \textcolor{comment}{// Progressive motility}
00260       String progressMotility\_value = \textcolor{stringliteral}{"NO"};
00261       \textcolor{keywordflow}{if} (str\_value > \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_ae9dd6b8ec81f8ae0b40a4e8e2d9cdc06}{progressMotility}) \{
00262         progressMotility\_value = \textcolor{stringliteral}{"YES"};
00263         countProgressiveSperm++;
00264       \}
00265       \textcolor{comment}{// DANCE}
00266       \textcolor{keywordtype}{float} dance\_value = vcl\_value * alh\_values[0];\textcolor{comment}{// vcl*alh\_mean}
00267       total\_dance += dance\_value;
00268       \textcolor{comment}{// MAD}
00269       \textcolor{keywordtype}{float} mad\_value = K.\hyperlink{classfunctions_1_1_kinematics_a2b60196aad8d0eecb1c3048e0163ebc3}{mad}(aTrack);
00270       total\_mad += mad\_value;
00271 
00272       rt.incrementCounter();
00273       rt.addValue(\textcolor{stringliteral}{"Length (frames)"}, length);
00274       rt.addValue(\textcolor{stringliteral}{"VSL (um/s)"}, vsl\_value);
00275       rt.addValue(\textcolor{stringliteral}{"VCL (um/s)"}, vcl\_value);
00276       rt.addValue(\textcolor{stringliteral}{"VAP (um/s)"}, vap\_value);
00277       rt.addValue(\textcolor{stringliteral}{"LIN"}, lin\_value);
00278       rt.addValue(\textcolor{stringliteral}{"WOB"}, wob\_value);
00279       rt.addValue(\textcolor{stringliteral}{"STR"}, str\_value);
00280       rt.addValue(\textcolor{stringliteral}{"ALH\_Mean (um)"}, alh\_values[0]);
00281       rt.addValue(\textcolor{stringliteral}{"ALH\_Max (um)"}, alh\_values[1]);
00282       rt.addValue(\textcolor{stringliteral}{"BCF (Hz)"}, bcf\_value);
00283       rt.addValue(\textcolor{stringliteral}{"DANCE (um^2/s)"}, dance\_value);
00284       rt.addValue(\textcolor{stringliteral}{"MAD (degrees)"}, mad\_value);
00285       rt.addValue(\textcolor{stringliteral}{"Progress Motility"}, progressMotility\_value);
00286       rt.addValue(\textcolor{stringliteral}{"Sample"}, trial.\hyperlink{classdata_1_1_trial_a0b86e44425dbe3c9d866aa273f87828a}{type});
00287       rt.addValue(\textcolor{stringliteral}{"ID"}, trial.\hyperlink{classdata_1_1_trial_a317298c3409575f71e43acd3f73ce295}{ID});
00288       rt.addValue(\textcolor{stringliteral}{"Source"}, trial.\hyperlink{classdata_1_1_trial_a00baeba9d13a88ce01098a02d1e570d5}{source});
00289       \textcolor{keywordflow}{if} (!\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a3e07114fb70a676dfe24fad6be8c3c75}{male}.isEmpty())
00290         rt.addValue(\textcolor{stringliteral}{"Male"}, \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a3e07114fb70a676dfe24fad6be8c3c75}{male});
00291       \textcolor{keywordflow}{if} (!\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_aecbab8174a6d72649883508cf9940d58}{date}.isEmpty())
00292         rt.addValue(\textcolor{stringliteral}{"Date"}, \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_aecbab8174a6d72649883508cf9940d58}{date});
00293       \textcolor{keywordflow}{if} (!\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a253e4e926c0399ed1ae42b5a5989824d}{genericField}.isEmpty())
00294         rt.addValue(\textcolor{stringliteral}{"Generic Field"}, \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a253e4e926c0399ed1ae42b5a5989824d}{genericField});
00295     \}
00296   \}
00297 
\hypertarget{_motility_8java_source_l00307}{}\hyperlink{classanalysis_1_1_motility_a6416a16af8e55569f37168bb76fe7174}{00307}   \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{classanalysis_1_1_motility_a6416a16af8e55569f37168bb76fe7174}{calculateTotalMotility}(ResultsTable rt, String filename) \{
00308 
00309     \textcolor{keywordtype}{float} vsl\_mean = total\_vsl / \hyperlink{classanalysis_1_1_motility_a2815eaed86c0b1e82e0fa050070546de}{total\_sperm};
00310     \textcolor{keywordtype}{float} vcl\_mean = total\_vcl / \hyperlink{classanalysis_1_1_motility_a2815eaed86c0b1e82e0fa050070546de}{total\_sperm};
00311     \textcolor{keywordtype}{float} vap\_mean = total\_vap / \hyperlink{classanalysis_1_1_motility_a2815eaed86c0b1e82e0fa050070546de}{total\_sperm};
00312     \textcolor{keywordtype}{float} lin\_mean = total\_lin / \hyperlink{classanalysis_1_1_motility_a2815eaed86c0b1e82e0fa050070546de}{total\_sperm};
00313     \textcolor{keywordtype}{float} wob\_mean = total\_wob / \hyperlink{classanalysis_1_1_motility_a2815eaed86c0b1e82e0fa050070546de}{total\_sperm};
00314     \textcolor{keywordtype}{float} str\_mean = total\_str / \hyperlink{classanalysis_1_1_motility_a2815eaed86c0b1e82e0fa050070546de}{total\_sperm};
00315     \textcolor{keywordtype}{float} alhMean\_mean = total\_alhMean / \hyperlink{classanalysis_1_1_motility_a2815eaed86c0b1e82e0fa050070546de}{total\_sperm};
00316     \textcolor{keywordtype}{float} alhMax\_mean = total\_alhMax / \hyperlink{classanalysis_1_1_motility_a2815eaed86c0b1e82e0fa050070546de}{total\_sperm};
00317     \textcolor{keywordtype}{float} bcf\_mean = total\_bcf / \hyperlink{classanalysis_1_1_motility_a2815eaed86c0b1e82e0fa050070546de}{total\_sperm};
00318     \textcolor{keywordtype}{float} dance\_mean = total\_dance / \hyperlink{classanalysis_1_1_motility_a2815eaed86c0b1e82e0fa050070546de}{total\_sperm};
00319     \textcolor{keywordtype}{float} mad\_mean = total\_mad / \hyperlink{classanalysis_1_1_motility_a2815eaed86c0b1e82e0fa050070546de}{total\_sperm};
00320     \textcolor{comment}{// % progressive Motile sperm}
00321     \textcolor{keywordtype}{float} progressiveMotPercent = countProgressiveSperm / (float) total\_sperm;
00322     \textcolor{comment}{// % motility}
00323     \textcolor{keywordtype}{float} motility\_value = (float) total\_motile / ((\textcolor{keywordtype}{float}) (total\_motile + 
      \hyperlink{classanalysis_1_1_motility_a12c018b723047f29c67110a7bb1134a8}{total\_nonMotile}));
00324 
00325     rt.incrementCounter();
00326     rt.addValue(\textcolor{stringliteral}{"Motile trajectories"}, total\_sperm);
00327     rt.addValue(\textcolor{stringliteral}{"VSL Mean (um/s)"}, vsl\_mean);
00328     rt.addValue(\textcolor{stringliteral}{"VCL Mean (um/s)"}, vcl\_mean);
00329     rt.addValue(\textcolor{stringliteral}{"VAP Mean (um/s)"}, vap\_mean);
00330     rt.addValue(\textcolor{stringliteral}{"LIN Mean "}, lin\_mean);
00331     rt.addValue(\textcolor{stringliteral}{"WOB Mean "}, wob\_mean);
00332     rt.addValue(\textcolor{stringliteral}{"STR Mean "}, str\_mean);
00333     rt.addValue(\textcolor{stringliteral}{"ALH\_Mean Mean (um)"}, alhMean\_mean);
00334     rt.addValue(\textcolor{stringliteral}{"ALH\_Max Mean (um)"}, alhMax\_mean);
00335     rt.addValue(\textcolor{stringliteral}{"BCF Mean (Hz)"}, bcf\_mean);
00336     rt.addValue(\textcolor{stringliteral}{"DANCE Mean (um^2/s)"}, dance\_mean);
00337     rt.addValue(\textcolor{stringliteral}{"MAD Mean (degrees)"}, mad\_mean);
00338     rt.addValue(\textcolor{stringliteral}{"Progressive Motility (%)"}, progressiveMotPercent * 100);
00339     rt.addValue(\textcolor{stringliteral}{"Motility (%)"}, motility\_value * 100);
00340     rt.addValue(\textcolor{stringliteral}{"Filename"}, filename);
00341     \textcolor{keywordflow}{if} (!\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a3e07114fb70a676dfe24fad6be8c3c75}{male}.isEmpty())
00342       rt.addValue(\textcolor{stringliteral}{"Male"}, \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a3e07114fb70a676dfe24fad6be8c3c75}{male});
00343     \textcolor{keywordflow}{if} (!\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_aecbab8174a6d72649883508cf9940d58}{date}.isEmpty())
00344       rt.addValue(\textcolor{stringliteral}{"Date"}, \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_aecbab8174a6d72649883508cf9940d58}{date});
00345     \textcolor{keywordflow}{if} (!\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a253e4e926c0399ed1ae42b5a5989824d}{genericField}.isEmpty())
00346       rt.addValue(\textcolor{stringliteral}{"Generic Field"}, \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a253e4e926c0399ed1ae42b5a5989824d}{genericField});
00347   \}
00348 
00353   @Override
\hypertarget{_motility_8java_source_l00354}{}\hyperlink{classanalysis_1_1_motility_ab048bf7b5ce8c46bb48b99b8d0999110}{00354}   \textcolor{keyword}{protected} Boolean \hyperlink{classanalysis_1_1_motility_ab048bf7b5ce8c46bb48b99b8d0999110}{doInBackground}() throws Exception \{
00355     \textcolor{keywordflow}{switch} (analysis) \{
00356       \textcolor{keywordflow}{case} FILE:
00357         \hyperlink{classanalysis_1_1_motility_a0b1464e818c4300782cb7e3322448f95}{analyseFile}();
00358         \textcolor{keywordflow}{break};
00359       \textcolor{keywordflow}{case} DIRECTORY:
00360         \hyperlink{classanalysis_1_1_motility_ad8447fb7554f7f126822c7a3f3f680ce}{analyseDirectory}();
00361         \textcolor{keywordflow}{break};
00362       \textcolor{keywordflow}{case} DIRECTORIES:
00363         \hyperlink{classanalysis_1_1_motility_ab3d086d15d667db78ea6785d8fc90223}{analyseDirectories}();
00364         \textcolor{keywordflow}{break};
00365     \}
00366     \textcolor{keywordflow}{return} null;
00367   \}
00368 
\hypertarget{_motility_8java_source_l00376}{}\hyperlink{classanalysis_1_1_motility_a5580224f7f7e9df7d925ad14f9364d98}{00376}   \textcolor{keyword}{private} Map<String, Trial> \hyperlink{classanalysis_1_1_motility_a5580224f7f7e9df7d925ad14f9364d98}{getTrials}(List<String> filenames) \{
00377     \textcolor{comment}{// Extract Trials}
00378     \hyperlink{classfunctions_1_1_trial_manager}{TrialManager} tm = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_trial_manager}{TrialManager}();
00379     Map<String, Trial> trials = \textcolor{keyword}{new} HashMap<String, Trial>();
00380     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < filenames.size(); i++) \{
00381       String file = filenames.get(i);
00382       \hyperlink{classdata_1_1_trial}{Trial} trial = tm.\hyperlink{classfunctions_1_1_trial_manager_a5d815ce30de28983d08c22c909562e11}{getTrialFromAVI}(file);
00383       \textcolor{keywordflow}{if} (trial != null)
00384         trials.put(trial.\hyperlink{classdata_1_1_trial_a0b86e44425dbe3c9d866aa273f87828a}{type} + \textcolor{stringliteral}{"-\_-"} + trial.\hyperlink{classdata_1_1_trial_a317298c3409575f71e43acd3f73ce295}{ID}, trial); \textcolor{comment}{// Expression "-\_-" is}
00385                                                           \textcolor{comment}{// just a separator}
00386     \}
00387     \textcolor{keywordflow}{return} trials;
00388   \}
00389 
\hypertarget{_motility_8java_source_l00393}{}\hyperlink{classanalysis_1_1_motility_a20915c32899c4bbe4d08e483bd5eb09c}{00393}   \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{classanalysis_1_1_motility_a20915c32899c4bbe4d08e483bd5eb09c}{resetParams}() \{
00394     total\_sperm = 0;
00395     total\_vsl = 0;
00396     total\_vcl = 0;
00397     total\_vap = 0;
00398     total\_lin = 0;
00399     total\_wob = 0;
00400     total\_str = 0;
00401     total\_alhMean = 0;
00402     total\_alhMax = 0;
00403     total\_bcf = 0;
00404     total\_dance = 0;
00405     total\_mad = 0;
00406     total\_motile = 0;
00407     total\_nonMotile = 0;
00408     countProgressiveSperm = 0;
00409   \}
00410 
\hypertarget{_motility_8java_source_l00415}{}\hyperlink{classanalysis_1_1_motility_aef66a58ab7f95817a68a3429550562fc}{00415}   \textcolor{keyword}{public} \textcolor{keywordtype}{void} \hyperlink{classanalysis_1_1_motility_aef66a58ab7f95817a68a3429550562fc}{selectAnalysis}() \{
00416     \textcolor{comment}{// Ask if user wants to analyze a file or directory}
00417     Object[] options = \{ \textcolor{stringliteral}{"File"}, \textcolor{stringliteral}{"Directory"}, \textcolor{stringliteral}{"Multiple directories"} \};
00418     String question = \textcolor{stringliteral}{"What do you want to analyze?"};
00419     String title = \textcolor{stringliteral}{"Choose one analysis..."};
00420     \textcolor{keyword}{final} \textcolor{keywordtype}{int} FILE = 0;
00421     \textcolor{keyword}{final} \textcolor{keywordtype}{int} DIR = 1;
00422     \textcolor{keyword}{final} \textcolor{keywordtype}{int} MULTIDIR = 2;
00423     \hyperlink{classfunctions_1_1_utils}{Utils} utils = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_utils}{Utils}();
00424     \textcolor{keywordtype}{int} sourceSelection = utils.\hyperlink{classfunctions_1_1_utils_a0e53c856e8bb35342f949c2f320d0e74}{analysisSelectionDialog}(options, question, title);
00425     \textcolor{keywordflow}{if} (sourceSelection < 0) \{
00426       \textcolor{keywordflow}{return};
00427     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (sourceSelection == FILE) \{
00428       analysis = \hyperlink{enumanalysis_1_1_motility_1_1_type_of_analysis}{TypeOfAnalysis}.\hyperlink{enumanalysis_1_1_motility_1_1_type_of_analysis_a49ca3d2aae1b4847965178deb5633261}{FILE};
00429     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (sourceSelection == DIR) \{
00430       analysis = \hyperlink{enumanalysis_1_1_motility_1_1_type_of_analysis}{TypeOfAnalysis}.\hyperlink{enumanalysis_1_1_motility_1_1_type_of_analysis_ace72c1d90b5a48ebbddd2be5b5f9368f}{DIRECTORY};
00431     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (sourceSelection == MULTIDIR) \{
00432       analysis = \hyperlink{enumanalysis_1_1_motility_1_1_type_of_analysis}{TypeOfAnalysis}.\hyperlink{enumanalysis_1_1_motility_1_1_type_of_analysis_afbd1f04e1781e8136dee40ac5096959c}{DIRECTORIES};
00433     \}
00434   \}
00435 \}
\end{DoxyCode}
