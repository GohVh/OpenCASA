\hypertarget{_chemotaxis_8java_source}{}\section{Chemotaxis.\+java}
\label{_chemotaxis_8java_source}\index{Chemotaxis.\+java@{Chemotaxis.\+java}}

\begin{DoxyCode}
00001 \textcolor{comment}{/*}
00002 \textcolor{comment}{ *   OpenCASA software v0.8 for video and image analysis}
00003 \textcolor{comment}{ *   Copyright (C) 2017  Carlos Alqu√©zar}
00004 \textcolor{comment}{ *}
00005 \textcolor{comment}{ *   This program is free software: you can redistribute it and/or modify}
00006 \textcolor{comment}{ *   it under the terms of the GNU General Public License as published by}
00007 \textcolor{comment}{ *   the Free Software Foundation, either version 3 of the License, or}
00008 \textcolor{comment}{ *   (at your option) any later version.}
00009 \textcolor{comment}{ *}
00010 \textcolor{comment}{ *   This program is distributed in the hope that it will be useful,}
00011 \textcolor{comment}{ *   but WITHOUT ANY WARRANTY; without even the implied warranty of}
00012 \textcolor{comment}{ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
00013 \textcolor{comment}{ *   GNU General Public License for more details.}
00014 \textcolor{comment}{ *}
00015 \textcolor{comment}{ *   You should have received a copy of the GNU General Public License}
00016 \textcolor{comment}{ *   along with this program.  If not, see <https://www.gnu.org/licenses/>.}
00017 \textcolor{comment}{*/}         
00018 
\hypertarget{_chemotaxis_8java_source_l00019}{}\hyperlink{namespaceanalysis}{00019} \textcolor{keyword}{package }analysis;
00020 
00021 \textcolor{keyword}{import} java.util.ArrayList;
00022 \textcolor{keyword}{import} java.util.Collections;
00023 \textcolor{keyword}{import} java.util.HashMap;
00024 \textcolor{keyword}{import} java.util.List;
00025 \textcolor{keyword}{import} java.util.ListIterator;
00026 \textcolor{keyword}{import} java.util.Map;
00027 \textcolor{keyword}{import} java.util.Set;
00028 
00029 \textcolor{keyword}{import} javax.swing.SwingWorker;
00030 
00031 \textcolor{keyword}{import} \hyperlink{namespacedata}{data}.\hyperlink{classdata_1_1_params}{Params};
00032 \textcolor{keyword}{import} \hyperlink{namespacedata}{data}.\hyperlink{classdata_1_1_serializable_list}{SerializableList};
00033 \textcolor{keyword}{import} \hyperlink{namespacedata}{data}.\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon};
00034 \textcolor{keyword}{import} \hyperlink{namespacedata}{data}.\hyperlink{classdata_1_1_trial}{Trial};
00035 \textcolor{keyword}{import} \hyperlink{namespacefunctions}{functions}.\hyperlink{classfunctions_1_1_file_manager}{FileManager};
00036 \textcolor{keyword}{import} \hyperlink{namespacefunctions}{functions}.\hyperlink{classfunctions_1_1_paint}{Paint};
00037 \textcolor{keyword}{import} \hyperlink{namespacefunctions}{functions}.\hyperlink{classfunctions_1_1_trial_manager}{TrialManager};
00038 \textcolor{keyword}{import} \hyperlink{namespacefunctions}{functions}.\hyperlink{classfunctions_1_1_utils}{Utils};
00039 \textcolor{keyword}{import} ij.IJ;
00040 \textcolor{keyword}{import} ij.gui.GenericDialog;
00041 \textcolor{keyword}{import} ij.measure.ResultsTable;
00042 
\hypertarget{_chemotaxis_8java_source_l00048}{}\hyperlink{classanalysis_1_1_chemotaxis}{00048} \textcolor{keyword}{public} \textcolor{keyword}{class }\hyperlink{classanalysis_1_1_chemotaxis}{Chemotaxis} \textcolor{keyword}{extends} SwingWorker<Boolean, String> \{
00049 
\hypertarget{_chemotaxis_8java_source_l00050}{}\hyperlink{enumanalysis_1_1_chemotaxis_1_1_type_of_analysis}{00050}   \textcolor{keyword}{private} \textcolor{keyword}{enum} \hyperlink{enumanalysis_1_1_chemotaxis_1_1_type_of_analysis}{TypeOfAnalysis} \{
\hypertarget{_chemotaxis_8java_source_l00051}{}\hyperlink{enumanalysis_1_1_chemotaxis_1_1_type_of_analysis_a899caa602e4fff675b17cdbab33607ec}{00051}     BOOTSTRAPPING, BOOTSTRAPPINGSIMULATIONS, INDEXESDIRECTORY, INDEXESFILE, INDEXESSIMULATIONS, NONE
00052   \}
00053 
\hypertarget{_chemotaxis_8java_source_l00054}{}\hyperlink{classanalysis_1_1_chemotaxis_ae0c6f15cfb3c589fb7817738e51998bd}{00054}   \textcolor{keyword}{private} \hyperlink{enumanalysis_1_1_chemotaxis_1_1_type_of_analysis}{TypeOfAnalysis} \hyperlink{namespaceanalysis}{analysis} = \hyperlink{enumanalysis_1_1_chemotaxis_1_1_type_of_analysis}{TypeOfAnalysis}.
      \hyperlink{enumanalysis_1_1_chemotaxis_1_1_type_of_analysis_a899caa602e4fff675b17cdbab33607ec}{NONE};
00055 
\hypertarget{_chemotaxis_8java_source_l00066}{}\hyperlink{classanalysis_1_1_chemotaxis_aaa89eb018d311df9e98b904088d282a5}{00066}   \textcolor{keyword}{private} ResultsTable \hyperlink{classanalysis_1_1_chemotaxis_aaa89eb018d311df9e98b904088d282a5}{analyseCondition}(Map<String, Trial> controls, Map<String, Trial> 
      tests) \{
00067     ResultsTable rt = \textcolor{keyword}{new} ResultsTable();
00068     \textcolor{keywordflow}{switch} (analysis) \{
00069       \textcolor{keywordflow}{case} INDEXESDIRECTORY:
00070       \textcolor{keywordflow}{case} INDEXESSIMULATIONS:
00071         rt = \hyperlink{classanalysis_1_1_chemotaxis_ae0431b7311aa1bb593e062536734de2c}{indexesAnalysis}(controls, tests);
00072         \textcolor{keywordflow}{break};
00073       \textcolor{keywordflow}{case} BOOTSTRAPPING:
00074       \textcolor{keywordflow}{case} BOOTSTRAPPINGSIMULATIONS:
00075         rt = \hyperlink{classanalysis_1_1_chemotaxis_a381aa5dd2dd75a72b6b21f7b2475d888}{bootstrappingAnalysis}(controls, tests);
00076         \textcolor{keywordflow}{break};
00077       \textcolor{keywordflow}{default}:
00078     \}
00079     \textcolor{keywordflow}{return} rt;
00080   \}
00081 
\hypertarget{_chemotaxis_8java_source_l00088}{}\hyperlink{classanalysis_1_1_chemotaxis_ad8447fb7554f7f126822c7a3f3f680ce}{00088}   \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{classanalysis_1_1_chemotaxis_ad8447fb7554f7f126822c7a3f3f680ce}{analyseDirectory}() \{
00089     \hyperlink{classfunctions_1_1_file_manager}{FileManager} fm = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_file_manager}{FileManager}();
00090     String folder = fm.\hyperlink{classfunctions_1_1_file_manager_af19fd6734ccb746c4f276c83b6a47689}{selectFolder}();
00091     Map<String, Trial> cTrials = \hyperlink{classanalysis_1_1_chemotaxis_a00ea60f92f2e11a363c01d04b6df7f10}{getControlTrials}(folder);
00092     List<String> testFolders = \hyperlink{classanalysis_1_1_chemotaxis_a973011dfbed998ea23443c2b79ac9ee3}{getTestFolders}(folder);
00093     \textcolor{keywordflow}{if}(testFolders.size()==0)\{
00094       IJ.showMessage(\textcolor{stringliteral}{"No \(\backslash\)"test\(\backslash\)" folders have been found"});
00095       \textcolor{keywordflow}{return};
00096     \}
00097     \textcolor{keywordflow}{for} (String f : testFolders) \{
00098       List<String> tests = fm.\hyperlink{classfunctions_1_1_file_manager_a3a54a5574abfddd928b2b8675e8affa6}{getFiles}(f);
00099       Map<String, Trial> tTrials = \hyperlink{classanalysis_1_1_chemotaxis_a5580224f7f7e9df7d925ad14f9364d98}{getTrials}(tests);
00100       ResultsTable rt = \hyperlink{classanalysis_1_1_chemotaxis_aaa89eb018d311df9e98b904088d282a5}{analyseCondition}(cTrials, tTrials);
00101       String condition = fm.\hyperlink{classfunctions_1_1_file_manager_ad027758f34214960a7aa800e0f7c19db}{getFilename}(f);
00102       \textcolor{keywordflow}{if}(rt!=null)
00103         rt.show(condition);
00104     \}
00105   \}
00106 
\hypertarget{_chemotaxis_8java_source_l00111}{}\hyperlink{classanalysis_1_1_chemotaxis_a0b1464e818c4300782cb7e3322448f95}{00111}   \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{classanalysis_1_1_chemotaxis_a0b1464e818c4300782cb7e3322448f95}{analyseFile}() \{
00112     \hyperlink{classfunctions_1_1_file_manager}{FileManager} fm = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_file_manager}{FileManager}();
00113     String file = fm.\hyperlink{classfunctions_1_1_file_manager_aa741a9e7ac4127ae1a463fb626474edf}{selectFile}();
00114     \hyperlink{classfunctions_1_1_trial_manager}{TrialManager} tm = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_trial_manager}{TrialManager}();
00115     \hyperlink{classdata_1_1_trial}{Trial} trial = tm.\hyperlink{classfunctions_1_1_trial_manager_a5d815ce30de28983d08c22c909562e11}{getTrialFromAVI}(file);
00116     \hyperlink{classanalysis_1_1_chemotaxis_ab864eab3ca8e5147e34d6a4747d24e72}{drawResults}(trial);
00117     \textcolor{keywordflow}{if}(\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_ae8b85275ab9c5375a3d35dcb7cd8332f}{printXY})\{
00118       \hyperlink{classfunctions_1_1_utils}{Utils} utils = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_utils}{Utils}();
00119       IJ.saveString(utils.\hyperlink{classfunctions_1_1_utils_ab85218da3569b5a7c0b9749e7b2b747a}{printXYCoords}(trial.\hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks}),\textcolor{stringliteral}{""});
00120     \}
00121   \}
00122 
\hypertarget{_chemotaxis_8java_source_l00128}{}\hyperlink{classanalysis_1_1_chemotaxis_ad992aa584aa410ee10b0b5df660c43ec}{00128}   \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{classanalysis_1_1_chemotaxis_ad992aa584aa410ee10b0b5df660c43ec}{analyseSimulations}() \{
00129     GenericDialog gd = \textcolor{keyword}{new} GenericDialog(\textcolor{stringliteral}{"Set Simulation parameters"});
00130     gd.addNumericField(\textcolor{stringliteral}{"Beta"}, 0, 2);
00131     gd.addNumericField(\textcolor{stringliteral}{"Responsiveness (%)"}, 50, 2);
00132     gd.addNumericField(\textcolor{stringliteral}{"Number of simulations"}, 50, 0);
00133     gd.showDialog();
00134     \textcolor{keywordflow}{if} (gd.wasCanceled())
00135       \textcolor{keywordflow}{return};
00136     \textcolor{keyword}{final} \textcolor{keywordtype}{double} BETA = gd.getNextNumber();
00137     \textcolor{keyword}{final} \textcolor{keywordtype}{double} RESPONSIVENESS = gd.getNextNumber() / 100;\textcolor{comment}{// value must be}
00138                                                            \textcolor{comment}{// between [0,1]}
00139     \textcolor{keyword}{final} \textcolor{keywordtype}{int} TOTALSIMULATIONS = (int) gd.getNextNumber();
00140     \hyperlink{classfunctions_1_1_trial_manager}{TrialManager} tm = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_trial_manager}{TrialManager}();
00141     Map<String, Trial> controls = tm.\hyperlink{classfunctions_1_1_trial_manager_a83f9d10eaa1ef4efb6de1f0e8b690978}{simulateTrials}(0, 0, TOTALSIMULATIONS);
00142     Map<String, Trial> tests = tm.\hyperlink{classfunctions_1_1_trial_manager_a83f9d10eaa1ef4efb6de1f0e8b690978}{simulateTrials}(BETA, RESPONSIVENESS, TOTALSIMULATIONS);
00143     ResultsTable rt = \hyperlink{classanalysis_1_1_chemotaxis_aaa89eb018d311df9e98b904088d282a5}{analyseCondition}(controls, tests);
00144     rt.show(\textcolor{stringliteral}{"Results from Simulation (Beta: "} + BETA + \textcolor{stringliteral}{",Responsiveness: "} + RESPONSIVENESS + \textcolor{stringliteral}{")"});
00145   \}
00146 
\hypertarget{_chemotaxis_8java_source_l00156}{}\hyperlink{classanalysis_1_1_chemotaxis_a381aa5dd2dd75a72b6b21f7b2475d888}{00156}   \textcolor{keyword}{private} ResultsTable \hyperlink{classanalysis_1_1_chemotaxis_a381aa5dd2dd75a72b6b21f7b2475d888}{bootstrappingAnalysis}(Map<String, Trial> controls, Map<String,
       Trial> tests) \{
00157 
00158     \textcolor{keyword}{final} \textcolor{keywordtype}{int} cMin = \hyperlink{classanalysis_1_1_chemotaxis_a3ae63569c841ffc6aa09be276f526c03}{minSampleSize}(controls);
00159     \textcolor{keyword}{final} \textcolor{keywordtype}{int} tMin = \hyperlink{classanalysis_1_1_chemotaxis_a3ae63569c841ffc6aa09be276f526c03}{minSampleSize}(tests);
00160     \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a11078ae453283411c72774c45caa7519}{MAXINSTANGLES} = Math.min(cMin, tMin);
00161     ResultsTable rt = \textcolor{keyword}{new} ResultsTable();
00162     \textcolor{keywordflow}{if}(!\hyperlink{classanalysis_1_1_chemotaxis_a1ebc6d4aaad3ec1c0eca87acb729ffb5}{checkPairs}(controls,tests))\{
00163        String condition = ((\hyperlink{classdata_1_1_trial}{Trial}) tests.values().toArray()[0]).type;
00164        IJ.showMessage(\textcolor{stringliteral}{"No pairs (control-"}+condition+\textcolor{stringliteral}{") with the same ID have been found"});
00165        \textcolor{keywordflow}{return} null;
00166     \}
00167     \textcolor{comment}{// Calculating OR threshold via resampling}
00168     \textcolor{keywordtype}{double} thControl = \hyperlink{classanalysis_1_1_chemotaxis_a8ee54f019a9258760e20482e3cd6b851}{orThreshold}(controls);
00169     \textcolor{keywordflow}{for} (String cKey : controls.keySet()) \{
00170       \hyperlink{classdata_1_1_trial}{Trial} cTrial = (\hyperlink{classdata_1_1_trial}{Trial}) controls.get(cKey);
00171       \hyperlink{classdata_1_1_trial}{Trial} tTrial = \hyperlink{classanalysis_1_1_chemotaxis_a40fa55bdb0e1b4e7e0f9de92076ab2f9}{findTrial}(cTrial.\hyperlink{classdata_1_1_trial_a317298c3409575f71e43acd3f73ce295}{ID}, tests);
00172       \textcolor{keywordflow}{if} (tTrial != null) \{
00173         \textcolor{keywordtype}{double} \hyperlink{classanalysis_1_1_chemotaxis_a4cf45f4c73ebe44a71a622c690f0b331}{or} = \hyperlink{classanalysis_1_1_chemotaxis_a4cf45f4c73ebe44a71a622c690f0b331}{or}(cTrial, tTrial);
00174         \hyperlink{classanalysis_1_1_chemotaxis_ac5db76309b6da4b0f351cdbb5876fec4}{setBootstrappingResults}(rt, or, thControl, tTrial);
00175       \}
00176     \}
00177     \textcolor{keywordflow}{return} rt;
00178   \}
00179   \textcolor{comment}{/******************************************************/}
\hypertarget{_chemotaxis_8java_source_l00187}{}\hyperlink{classanalysis_1_1_chemotaxis_a4ab493d2d901c65e8387095a69cbf83d}{00187}   \textcolor{keyword}{private} \textcolor{keywordtype}{float} \hyperlink{classanalysis_1_1_chemotaxis_a4ab493d2d901c65e8387095a69cbf83d}{calculateChIndex}(List<List<Spermatozoon>> theTracks) \{
00188     \textcolor{keywordtype}{int} trackNr = 0; \textcolor{comment}{// Number of tracks}
00189     \textcolor{keywordtype}{int} nTracks = theTracks.size();
00190     \textcolor{keywordtype}{int}[] displacements = \{ 0, 0 \};
00191     \textcolor{keywordflow}{for} (List<Spermatozoon> track : theTracks) \{
00192       IJ.showProgress((\textcolor{keywordtype}{double}) trackNr / nTracks);
00193       IJ.showStatus(\textcolor{stringliteral}{"Calculating Ch-Index..."});
00194       trackNr++;
00195       \textcolor{keywordtype}{int}[] instD = \hyperlink{classanalysis_1_1_chemotaxis_a668ad1c1240012d6fb70c1fac4a219be}{countInstantDisplacements}(track);
00196       displacements[0] += instD[0];
00197       displacements[1] += instD[1];
00198     \}
00199     \textcolor{keywordtype}{float} nUpGradient = displacements[0]; \textcolor{comment}{// Number of displacements in the}
00200                                           \textcolor{comment}{// gradient direction}
00201     \textcolor{keywordtype}{float} nOtherDirs = displacements[1]; \textcolor{comment}{// Number of displacements in other}
00202                                          \textcolor{comment}{// direction}
00203     \textcolor{comment}{// IJ.log("nUpGradient: "+nUpGradient+"; nOtherDirs: "+nOtherDirs);}
00204     \textcolor{keywordtype}{float} chIdx = 0;
00205     \textcolor{keywordflow}{if} ((nUpGradient + nOtherDirs) > 0) \{
00206       chIdx = nUpGradient / (nUpGradient + nOtherDirs); \textcolor{comment}{// (nUpGradient+nOtherDirs)}
00207                                                         \textcolor{comment}{// = Total number of}
00208                                                         \textcolor{comment}{// shifts}
00209     \} \textcolor{keywordflow}{else} \{
00210       chIdx = -1;
00211     \}
00212     \textcolor{keywordflow}{return} chIdx; \textcolor{comment}{// return index between [0,1]}
00213   \}
00214 
00215   \textcolor{comment}{/******************************************************/}
\hypertarget{_chemotaxis_8java_source_l00223}{}\hyperlink{classanalysis_1_1_chemotaxis_ae3ff70acea28007b345ce335321b82fe}{00223}   \textcolor{keyword}{private} \textcolor{keywordtype}{float} \hyperlink{classanalysis_1_1_chemotaxis_ae3ff70acea28007b345ce335321b82fe}{calculateSLIndex}(List<List<Spermatozoon>> theTracks) \{
00224 
00225     \textcolor{keywordtype}{float} nUpGradient = 0; \textcolor{comment}{// Number of shifts in the chemoattractant direction}
00226     \textcolor{keywordtype}{float} nOtherDirs = 0; \textcolor{comment}{// Number of shifts in other direction}
00227     \textcolor{keywordtype}{int} trackNr = 0;
00228     \textcolor{keywordtype}{int} nTracks = theTracks.size();
00229     \textcolor{keywordtype}{double} angleChemotaxis = (2 * Math.PI + (\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a42568ad774d8f4ccb9535aeda39fc883}{angleAmplitude} / 2) * Math.PI / 180
      ) % (2 * Math.PI);
00230     \textcolor{keywordtype}{float} ratioSL = 0;
00231     \textcolor{keywordflow}{for} (List<Spermatozoon> aTrack : theTracks) \{
00232       IJ.showProgress((\textcolor{keywordtype}{double}) trackNr / nTracks);
00233       IJ.showStatus(\textcolor{stringliteral}{"Calculating SL-Index..."});
00234       trackNr++;
00235       \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} first = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) aTrack.get(1);
00236       \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} last = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) aTrack.get(aTrack.size() - 1);
00237       \textcolor{keywordtype}{double} angle = \hyperlink{classanalysis_1_1_chemotaxis_ab23f946e0f1055d348e975e3058f323d}{relativeAngle}(first, last); \textcolor{comment}{// Between [-PI,PI]}
00238       \textcolor{comment}{// Check if the angle is upGradient or not}
00239       \textcolor{keywordflow}{if} (Math.abs(angle) < angleChemotaxis) \{
00240         nUpGradient++;
00241       \} \textcolor{keywordflow}{else} \{
00242         nOtherDirs++;
00243       \}
00244     \}
00245     \textcolor{keywordflow}{if} ((nUpGradient + nOtherDirs) > 0) \{
00246       ratioSL = nUpGradient / (nUpGradient + nOtherDirs);
00247     \} \textcolor{keywordflow}{else} \{
00248       ratioSL = -1;
00249     \}
00250     \textcolor{keywordflow}{return} ratioSL;
00251   \}
00252 
\hypertarget{_chemotaxis_8java_source_l00259}{}\hyperlink{classanalysis_1_1_chemotaxis_a1ebc6d4aaad3ec1c0eca87acb729ffb5}{00259}   \textcolor{keyword}{private} \textcolor{keywordtype}{boolean} \hyperlink{classanalysis_1_1_chemotaxis_a1ebc6d4aaad3ec1c0eca87acb729ffb5}{checkPairs}(Map<String, Trial> controls, Map<String, Trial> tests)\{
00260     \textcolor{keywordtype}{boolean} ok = \textcolor{keyword}{false};
00261     \textcolor{keywordflow}{for} (String cKey : controls.keySet()) \{
00262       \hyperlink{classdata_1_1_trial}{Trial} cTrial = (\hyperlink{classdata_1_1_trial}{Trial}) controls.get(cKey);
00263       \hyperlink{classdata_1_1_trial}{Trial} tTrial = \hyperlink{classanalysis_1_1_chemotaxis_a40fa55bdb0e1b4e7e0f9de92076ab2f9}{findTrial}(cTrial.\hyperlink{classdata_1_1_trial_a317298c3409575f71e43acd3f73ce295}{ID}, tests);
00264       \textcolor{keywordflow}{if} (tTrial != null) \{
00265         ok=\textcolor{keyword}{true};
00266         \textcolor{keywordflow}{return} ok;
00267       \}
00268     \}
00269     \textcolor{keywordflow}{return} ok;
00270   \}
00271 
\hypertarget{_chemotaxis_8java_source_l00281}{}\hyperlink{classanalysis_1_1_chemotaxis_a50fdf81a3460741674381622f16581cb}{00281}   \textcolor{keyword}{private} \textcolor{keywordtype}{int}[] \hyperlink{classanalysis_1_1_chemotaxis_a50fdf81a3460741674381622f16581cb}{circularHistogram}(List<Double> angles, \textcolor{keywordtype}{int} n) \{
00282 
00283     \textcolor{keywordtype}{int}[] histogram = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[n];
00284     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < n; i++) \{
00285       histogram[i] = 0;
00286     \}
00287     \textcolor{keyword}{final} \textcolor{keywordtype}{int} BINSIZE = 360 / n;
00288     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < angles.size(); i++) \{
00289       \textcolor{keywordtype}{int} bin = angles.get(i).intValue() / BINSIZE;
00290       histogram[bin]++;
00291     \}
00292     \textcolor{keywordflow}{return} histogram;
00293   \}
00294 
\hypertarget{_chemotaxis_8java_source_l00306}{}\hyperlink{classanalysis_1_1_chemotaxis_a55deae924cf7ec2004a8fdcd8e185f94}{00306}   \textcolor{keyword}{private} \textcolor{keywordtype}{int}[] \hyperlink{classanalysis_1_1_chemotaxis_a55deae924cf7ec2004a8fdcd8e185f94}{countAngles}(\hyperlink{classdata_1_1_serializable_list}{SerializableList} theTracks) \{
00307     \textcolor{keywordtype}{int}[] angles = \{ 0, 0 \};
00308     \textcolor{keywordflow}{for} (ListIterator iT = theTracks.listIterator(); iT.hasNext();) \{
00309       List aTrack = (ArrayList) iT.next();
00310       \textcolor{keywordtype}{int}[] instantAngles = \hyperlink{classanalysis_1_1_chemotaxis_a668ad1c1240012d6fb70c1fac4a219be}{countInstantDisplacements}(aTrack);
00311       angles[0] += instantAngles[0];
00312       angles[1] += instantAngles[1];
00313     \}
00314     \textcolor{keywordflow}{return} angles;
00315   \}
00316 
\hypertarget{_chemotaxis_8java_source_l00328}{}\hyperlink{classanalysis_1_1_chemotaxis_a668ad1c1240012d6fb70c1fac4a219be}{00328}   \textcolor{keyword}{private} \textcolor{keywordtype}{int}[] \hyperlink{classanalysis_1_1_chemotaxis_a668ad1c1240012d6fb70c1fac4a219be}{countInstantDisplacements}(List<Spermatozoon> track) \{
00329     \textcolor{keywordtype}{int} nUpGradient = 0;
00330     \textcolor{keywordtype}{int} nOtherDir = 0;
00331     \textcolor{keywordtype}{int} nPoints = track.size();
00332     \textcolor{keywordtype}{double} angleChemotaxis = (2 * Math.PI + (\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a42568ad774d8f4ccb9535aeda39fc883}{angleAmplitude} / 2) * Math.PI / 180
      ) % (2 * Math.PI);
00333     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < (nPoints - \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a93caa48162e34b2227a839ed71b4ed44}{angleDelta}); j++) \{
00334       \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} oldSpermatozoon = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) track.get(j);
00335       \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} newSpermatozoon = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) track.get(j + 
      \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a93caa48162e34b2227a839ed71b4ed44}{angleDelta});
00336       \textcolor{keywordtype}{double} angle = \hyperlink{classanalysis_1_1_chemotaxis_ab23f946e0f1055d348e975e3058f323d}{relativeAngle}(oldSpermatozoon, newSpermatozoon);\textcolor{comment}{// Between interval
       [-PI,PI]}
00337       \textcolor{keywordflow}{if} (\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a8c0dba3f8308ea1257549b3cef11ea23}{compareOppositeDirections}) \{\textcolor{comment}{// We only take into account
       angles in the gradient and opposite direction}
00338         \textcolor{keywordflow}{if} (Math.abs(angle) < angleChemotaxis) \{
00339           nUpGradient++;
00340         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (Math.abs(angle) > (Math.PI - angleChemotaxis)) \{
00341           nOtherDir++;
00342         \}
00343       \} \textcolor{keywordflow}{else} \{\textcolor{comment}{// We take into account all angles in all directions}
00344         \textcolor{keywordflow}{if} (Math.abs(angle) < angleChemotaxis) \{
00345           nUpGradient++;
00346         \} \textcolor{keywordflow}{else} \{
00347           nOtherDir++;
00348         \}
00349       \}
00350     \}
00351     \textcolor{keywordtype}{int}[] results = \textcolor{keyword}{new} \textcolor{keywordtype}{int}[2];
00352     results[0] = nUpGradient;
00353     results[1] = nOtherDir;
00354     \textcolor{keywordflow}{return} results;
00355   \}
00356 
00361   @Override
\hypertarget{_chemotaxis_8java_source_l00362}{}\hyperlink{classanalysis_1_1_chemotaxis_ab048bf7b5ce8c46bb48b99b8d0999110}{00362}   \textcolor{keyword}{public} Boolean \hyperlink{classanalysis_1_1_chemotaxis_ab048bf7b5ce8c46bb48b99b8d0999110}{doInBackground}() \{
00363 
00364     \textcolor{keywordflow}{switch} (analysis) \{
00365       \textcolor{keywordflow}{case} INDEXESFILE:
00366         \hyperlink{classanalysis_1_1_chemotaxis_a0b1464e818c4300782cb7e3322448f95}{analyseFile}();
00367         \textcolor{keywordflow}{break};
00368       \textcolor{keywordflow}{case} INDEXESDIRECTORY:
00369       \textcolor{keywordflow}{case} BOOTSTRAPPING:
00370         \hyperlink{classanalysis_1_1_chemotaxis_ad8447fb7554f7f126822c7a3f3f680ce}{analyseDirectory}();
00371         \textcolor{keywordflow}{break};
00372       \textcolor{keywordflow}{case} INDEXESSIMULATIONS:
00373       \textcolor{keywordflow}{case} BOOTSTRAPPINGSIMULATIONS:
00374         \hyperlink{classanalysis_1_1_chemotaxis_ad992aa584aa410ee10b0b5df660c43ec}{analyseSimulations}();
00375         \textcolor{keywordflow}{break};
00376     \}
00377 
00378     \textcolor{keywordflow}{return} null;
00379   \}
00380 
00385   @Override
\hypertarget{_chemotaxis_8java_source_l00386}{}\hyperlink{classanalysis_1_1_chemotaxis_ab650651e4cda2869f73100c6fd2c821a}{00386}   \textcolor{keyword}{protected} \textcolor{keywordtype}{void} \hyperlink{classanalysis_1_1_chemotaxis_ab650651e4cda2869f73100c6fd2c821a}{done}() \{
00387     \textcolor{comment}{// switch (analysis) \{}
00388     \textcolor{comment}{// case INDEXESFILE:}
00389     \textcolor{comment}{// break;}
00390     \textcolor{comment}{// case INDEXESDIRECTORY:}
00391     \textcolor{comment}{// break;}
00392     \textcolor{comment}{// case BOOTSTRAPPING:}
00393     \textcolor{comment}{// break;}
00394     \textcolor{comment}{// case INDEXESSIMULATIONS:}
00395     \textcolor{comment}{// break;}
00396     \textcolor{comment}{// case BOOTSTRAPPINGSIMULATIONS:}
00397     \textcolor{comment}{// break;}
00398     \textcolor{comment}{// \}}
00399   \}
00400 
\hypertarget{_chemotaxis_8java_source_l00407}{}\hyperlink{classanalysis_1_1_chemotaxis_ab864eab3ca8e5147e34d6a4747d24e72}{00407}   \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{classanalysis_1_1_chemotaxis_ab864eab3ca8e5147e34d6a4747d24e72}{drawResults}(\hyperlink{classdata_1_1_trial}{Trial} trial) \{
00408     \textcolor{keywordflow}{if} (trial == null)
00409       \textcolor{keywordflow}{return};
00410     \textcolor{keywordtype}{float} chIdx = \hyperlink{classanalysis_1_1_chemotaxis_a4ab493d2d901c65e8387095a69cbf83d}{calculateChIndex}(trial.\hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks});
00411     \textcolor{keywordtype}{float} slIdx = \hyperlink{classanalysis_1_1_chemotaxis_ae3ff70acea28007b345ce335321b82fe}{calculateSLIndex}(trial.\hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks});
00412     \textcolor{keywordtype}{int}[] hist = \hyperlink{classanalysis_1_1_chemotaxis_a50fdf81a3460741674381622f16581cb}{circularHistogram}(\hyperlink{classanalysis_1_1_chemotaxis_a0a5886ad5b1d3a1dee18ed4fe5da7ed8}{getListOfAngles}(trial.
      \hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks}), 45);
00413     \textcolor{keywordtype}{int} radius = trial.\hyperlink{classdata_1_1_trial_abce721f4aa25ad8ba8181de990a78b73}{fieldWidth};
00414     \hyperlink{classfunctions_1_1_paint}{Paint} paint = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_paint}{Paint}();
00415     paint.\hyperlink{classfunctions_1_1_paint_a21dbba9326aa66f10d1dfccb836c14d9}{drawChemotaxis}(trial, chIdx, slIdx);
00416     paint.\hyperlink{classfunctions_1_1_paint_ae6e7f899e277190943b0c57232976e97}{drawRoseDiagram}(hist, radius, chIdx, trial.\hyperlink{classdata_1_1_trial_a00baeba9d13a88ce01098a02d1e570d5}{source});
00417   \}
00418 
\hypertarget{_chemotaxis_8java_source_l00429}{}\hyperlink{classanalysis_1_1_chemotaxis_a40fa55bdb0e1b4e7e0f9de92076ab2f9}{00429}   \textcolor{keyword}{private} \hyperlink{classdata_1_1_trial}{Trial} \hyperlink{classanalysis_1_1_chemotaxis_a40fa55bdb0e1b4e7e0f9de92076ab2f9}{findTrial}(String \textcolor{keywordtype}{id}, Map<String, Trial> trials) \{
00430     \textcolor{keywordflow}{for} (String k : trials.keySet()) \{
00431       \hyperlink{classdata_1_1_trial}{Trial} trial = (\hyperlink{classdata_1_1_trial}{Trial}) trials.get(k);
00432       \textcolor{keywordflow}{if} (trial.\hyperlink{classdata_1_1_trial_a317298c3409575f71e43acd3f73ce295}{ID}.equalsIgnoreCase(\textcolor{keywordtype}{id}))
00433         \textcolor{keywordflow}{return} trial;
00434     \}
00435     \textcolor{keywordflow}{return} null;
00436   \}
00437 
\hypertarget{_chemotaxis_8java_source_l00438}{}\hyperlink{classanalysis_1_1_chemotaxis_a00ea60f92f2e11a363c01d04b6df7f10}{00438}   \textcolor{keyword}{private} Map<String, Trial> \hyperlink{classanalysis_1_1_chemotaxis_a00ea60f92f2e11a363c01d04b6df7f10}{getControlTrials}(String folder) \{
00439     \hyperlink{classfunctions_1_1_file_manager}{FileManager} fm = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_file_manager}{FileManager}();
00440     List<String> subFolders = fm.\hyperlink{classfunctions_1_1_file_manager_a73efd872c86ccdce535ddb2798aaaea4}{getSubfolders}(folder);
00441     String controlFolder = null;
00442     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < subFolders.size(); i++) \{
00443       String tempName = subFolders.get(i).toLowerCase();
00444       tempName = fm.\hyperlink{classfunctions_1_1_file_manager_ad027758f34214960a7aa800e0f7c19db}{getFilename}(tempName);
00445       \textcolor{keywordflow}{if} (tempName.equals(\textcolor{stringliteral}{"control"})) \{
00446         controlFolder = subFolders.get(i);
00447         \textcolor{keywordflow}{break};
00448       \}
00449     \}
00450     \textcolor{keywordflow}{if}(controlFolder==null)\{
00451       IJ.showMessage(\textcolor{stringliteral}{"No \(\backslash\)"control\(\backslash\)" folder has been found"});
00452       \textcolor{keywordflow}{return} \textcolor{keyword}{new} HashMap<String, Trial>();
00453     \}
00454     List<String> controlFiles = fm.\hyperlink{classfunctions_1_1_file_manager_a3a54a5574abfddd928b2b8675e8affa6}{getFiles}(controlFolder);
00455     Map<String, Trial> cTrials = \textcolor{keyword}{new} HashMap<String, Trial>();
00456     \hyperlink{classfunctions_1_1_trial_manager}{TrialManager} tm = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_trial_manager}{TrialManager}();
00457     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < controlFiles.size(); i++) \{
00458       String file = controlFiles.get(i);
00459       \hyperlink{classdata_1_1_trial}{Trial} trial = tm.getTrialFromAVI(file);
00460       \textcolor{keywordflow}{if} (trial != null)
00461         cTrials.put(trial.\hyperlink{classdata_1_1_trial_a0b86e44425dbe3c9d866aa273f87828a}{type} + \textcolor{stringliteral}{"-\_-"} + trial.\hyperlink{classdata_1_1_trial_a317298c3409575f71e43acd3f73ce295}{ID}, trial);
00462     \}
00463     \textcolor{keywordflow}{return} cTrials;
00464   \}
00465 
\hypertarget{_chemotaxis_8java_source_l00474}{}\hyperlink{classanalysis_1_1_chemotaxis_a0a5886ad5b1d3a1dee18ed4fe5da7ed8}{00474}   \textcolor{keyword}{private} List<Double> \hyperlink{classanalysis_1_1_chemotaxis_a0a5886ad5b1d3a1dee18ed4fe5da7ed8}{getListOfAngles}(\hyperlink{classdata_1_1_serializable_list}{SerializableList} theTracks) \{
00475     List<Double> instAngles = \textcolor{keyword}{new} ArrayList<Double>();
00476     \textcolor{keywordflow}{for} (ListIterator iT = theTracks.listIterator(); iT.hasNext();) \{
00477       List track = (ArrayList) iT.next();
00478       \textcolor{keywordtype}{int} nPoints = track.size();
00479       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < (nPoints - \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a93caa48162e34b2227a839ed71b4ed44}{angleDelta}); j++) \{
00480         \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} oldSpermatozoon = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) track.get(j);
00481         \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} newSpermatozoon = (\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon}) track.get(j + 
      \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a93caa48162e34b2227a839ed71b4ed44}{angleDelta});
00482         \textcolor{keywordtype}{float} diffX = newSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_ad0da36b2558901e21e7a30f6c227a45e}{x} - oldSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_ad0da36b2558901e21e7a30f6c227a45e}{x};
00483         \textcolor{keywordtype}{float} diffY = newSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_aa4f0d3eebc3c443f9be81bf48561a217}{y} - oldSpermatozoon.\hyperlink{classdata_1_1_spermatozoon_aa4f0d3eebc3c443f9be81bf48561a217}{y};
00484         \textcolor{keywordtype}{double} angle = (360 + Math.atan2(diffY, diffX) * 180 / Math.PI) % (360); \textcolor{comment}{// Absolute}
00485                                                                                  \textcolor{comment}{// angle}
00486         instAngles.add(angle);
00487       \}
00488     \}
00489     \textcolor{keywordflow}{return} instAngles;
00490   \}
00491 
\hypertarget{_chemotaxis_8java_source_l00505}{}\hyperlink{classanalysis_1_1_chemotaxis_a02c2fbfd2097bca3933e285e6712a58d}{00505}   \textcolor{keyword}{private} \textcolor{keywordtype}{double}[] \hyperlink{classanalysis_1_1_chemotaxis_a02c2fbfd2097bca3933e285e6712a58d}{getOddsValues}(\hyperlink{classdata_1_1_serializable_list}{SerializableList} tracks) \{
00506 
00507     \textcolor{keywordtype}{double}[] values = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[] \{ 0.0, 0.0 \};\textcolor{comment}{// [0]-upgradient}
00508                                                 \textcolor{comment}{// displacements;[1]-displacements}
00509                                                 \textcolor{comment}{// to other directionality}
00510     \textcolor{keywordtype}{int} count = 0;
00511     \textcolor{keywordtype}{int} index = 0;
00512     \textcolor{keywordflow}{while} ((count < \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a11078ae453283411c72774c45caa7519}{MAXINSTANGLES}) && (index < tracks.size())) \{
00513       \textcolor{keywordtype}{int}[] countInstDirections = \hyperlink{classanalysis_1_1_chemotaxis_a668ad1c1240012d6fb70c1fac4a219be}{countInstantDisplacements}((List) tracks.get(
      index));
00514       count += countInstDirections[0] + countInstDirections[1];
00515       values[0] += (double) countInstDirections[0]; \textcolor{comment}{// number of instantaneous}
00516                                                     \textcolor{comment}{// angles in the positive}
00517                                                     \textcolor{comment}{// direction}
00518       values[1] += (double) (countInstDirections[0] + countInstDirections[1]);
00519       index++;
00520     \}
00521     \textcolor{keywordflow}{return} values;
00522   \}
00523 
\hypertarget{_chemotaxis_8java_source_l00531}{}\hyperlink{classanalysis_1_1_chemotaxis_a973011dfbed998ea23443c2b79ac9ee3}{00531}   \textcolor{keyword}{private} List<String> \hyperlink{classanalysis_1_1_chemotaxis_a973011dfbed998ea23443c2b79ac9ee3}{getTestFolders}(String folder) \{
00532     \hyperlink{classfunctions_1_1_file_manager}{FileManager} fm = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_file_manager}{FileManager}();
00533     List<String> testFolders = fm.\hyperlink{classfunctions_1_1_file_manager_a73efd872c86ccdce535ddb2798aaaea4}{getSubfolders}(folder);
00534     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < testFolders.size(); i++) \{
00535       String tempName = testFolders.get(i).toLowerCase();
00536       tempName = fm.\hyperlink{classfunctions_1_1_file_manager_ad027758f34214960a7aa800e0f7c19db}{getFilename}(tempName);
00537       \textcolor{keywordflow}{if} (tempName.equals(\textcolor{stringliteral}{"control"})) \{
00538         testFolders.remove(i);
00539       \}
00540     \}
00541     \textcolor{keywordflow}{return} testFolders;
00542   \}
00543 
\hypertarget{_chemotaxis_8java_source_l00551}{}\hyperlink{classanalysis_1_1_chemotaxis_a5580224f7f7e9df7d925ad14f9364d98}{00551}   \textcolor{keyword}{private} Map<String, Trial> \hyperlink{classanalysis_1_1_chemotaxis_a5580224f7f7e9df7d925ad14f9364d98}{getTrials}(List<String> filenames) \{
00552     \textcolor{comment}{// Extract Trials}
00553     \hyperlink{classfunctions_1_1_trial_manager}{TrialManager} tm = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_trial_manager}{TrialManager}();
00554     Map<String, Trial> trials = \textcolor{keyword}{new} HashMap<String, Trial>();
00555     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < filenames.size(); i++) \{
00556       String file = filenames.get(i);
00557       \hyperlink{classdata_1_1_trial}{Trial} trial = tm.\hyperlink{classfunctions_1_1_trial_manager_a5d815ce30de28983d08c22c909562e11}{getTrialFromAVI}(file);
00558       \textcolor{keywordflow}{if} (trial != null)
00559         trials.put(trial.\hyperlink{classdata_1_1_trial_a0b86e44425dbe3c9d866aa273f87828a}{type} + \textcolor{stringliteral}{"-\_-"} + trial.\hyperlink{classdata_1_1_trial_a317298c3409575f71e43acd3f73ce295}{ID}, trial); \textcolor{comment}{// Expression "-\_-" is}
00560                                                           \textcolor{comment}{// just a separator}
00561     \}
00562     \textcolor{keywordflow}{return} trials;
00563   \}
00564 
\hypertarget{_chemotaxis_8java_source_l00574}{}\hyperlink{classanalysis_1_1_chemotaxis_ae0431b7311aa1bb593e062536734de2c}{00574}   \textcolor{keyword}{private} ResultsTable \hyperlink{classanalysis_1_1_chemotaxis_ae0431b7311aa1bb593e062536734de2c}{indexesAnalysis}(Map<String, Trial> controls, Map<String, Trial> tests
      ) \{
00575 
00576     Set<String> ckeySet = controls.keySet();
00577     Set<String> tkeySet = tests.keySet();
00578     ResultsTable rt = \textcolor{keyword}{new} ResultsTable();
00579     \textcolor{keywordflow}{for} (String k : ckeySet) \{
00580       \hyperlink{classdata_1_1_trial}{Trial} trial = (\hyperlink{classdata_1_1_trial}{Trial}) controls.get(k);
00581       \textcolor{keywordtype}{float} chIdx = \hyperlink{classanalysis_1_1_chemotaxis_a4ab493d2d901c65e8387095a69cbf83d}{calculateChIndex}(trial.\hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks});
00582       \textcolor{keywordtype}{float} slIdx = \hyperlink{classanalysis_1_1_chemotaxis_ae3ff70acea28007b345ce335321b82fe}{calculateSLIndex}(trial.\hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks});
00583       \hyperlink{classanalysis_1_1_chemotaxis_a9c90c33405ef04f0e75e5f8dcb56520e}{setIndexesResults}(rt, trial, chIdx, slIdx);
00584     \}
00585     \textcolor{keywordflow}{for} (String k : tkeySet) \{
00586       \hyperlink{classdata_1_1_trial}{Trial} trial = (\hyperlink{classdata_1_1_trial}{Trial}) tests.get(k);
00587       \textcolor{keywordtype}{float} chIdx = \hyperlink{classanalysis_1_1_chemotaxis_a4ab493d2d901c65e8387095a69cbf83d}{calculateChIndex}(trial.\hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks});
00588       \textcolor{keywordtype}{float} slIdx = \hyperlink{classanalysis_1_1_chemotaxis_ae3ff70acea28007b345ce335321b82fe}{calculateSLIndex}(trial.\hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks});
00589       \hyperlink{classanalysis_1_1_chemotaxis_a9c90c33405ef04f0e75e5f8dcb56520e}{setIndexesResults}(rt, trial, chIdx, slIdx);
00590     \}
00591     \textcolor{keywordflow}{return} rt;
00592   \}
00593 
\hypertarget{_chemotaxis_8java_source_l00602}{}\hyperlink{classanalysis_1_1_chemotaxis_a226e01e0b4acab847ec3b2c1bb233740}{00602}   \textcolor{keyword}{private} \hyperlink{classdata_1_1_serializable_list}{SerializableList} \hyperlink{classanalysis_1_1_chemotaxis_a226e01e0b4acab847ec3b2c1bb233740}{mergeTracks}(Map<String, Trial> trials) \{
00603 
00604     \hyperlink{classdata_1_1_serializable_list}{SerializableList} tracks = \textcolor{keyword}{new} \hyperlink{classdata_1_1_serializable_list}{SerializableList}();
00605     \textcolor{keywordflow}{for} (String k : trials.keySet()) \{
00606       \hyperlink{classdata_1_1_trial}{Trial} trial = (\hyperlink{classdata_1_1_trial}{Trial}) trials.get(k);
00607       tracks.addAll(trial.\hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks});
00608     \}
00609     \textcolor{keywordflow}{return} tracks;
00610   \}
00611 
\hypertarget{_chemotaxis_8java_source_l00621}{}\hyperlink{classanalysis_1_1_chemotaxis_a3ae63569c841ffc6aa09be276f526c03}{00621}   \textcolor{keyword}{private} \textcolor{keywordtype}{int} \hyperlink{classanalysis_1_1_chemotaxis_a3ae63569c841ffc6aa09be276f526c03}{minSampleSize}(Map<String, Trial> trials) \{
00622     \textcolor{keywordtype}{int} minimum = 999999999;
00623     \textcolor{keywordflow}{for} (String k : trials.keySet()) \{
00624       \hyperlink{classdata_1_1_trial}{Trial} t = (\hyperlink{classdata_1_1_trial}{Trial}) trials.get(k);
00625       \textcolor{keywordtype}{int}[] instantAngles = \hyperlink{classanalysis_1_1_chemotaxis_a55deae924cf7ec2004a8fdcd8e185f94}{countAngles}(t.\hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks});
00626       \textcolor{keywordtype}{int} sampleSize = instantAngles[0] + instantAngles[1];
00627       \textcolor{keywordflow}{if} (sampleSize < minimum) \{
00628         minimum = sampleSize;
00629       \}
00630     \}
00631     \textcolor{keywordflow}{return} minimum;
00632   \}
00633 
\hypertarget{_chemotaxis_8java_source_l00643}{}\hyperlink{classanalysis_1_1_chemotaxis_a4cf45f4c73ebe44a71a622c690f0b331}{00643}   \textcolor{keyword}{private} \textcolor{keywordtype}{double} \hyperlink{classanalysis_1_1_chemotaxis_a4cf45f4c73ebe44a71a622c690f0b331}{or}(\hyperlink{classdata_1_1_trial}{Trial} control, \hyperlink{classdata_1_1_trial}{Trial} test) \{
00644     \hyperlink{classdata_1_1_serializable_list}{SerializableList} controlTracks = control.\hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks};
00645     \hyperlink{classdata_1_1_serializable_list}{SerializableList} conditionTracks = test.\hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks};
00646     \textcolor{keywordtype}{double}[] numeratorValues = \hyperlink{classanalysis_1_1_chemotaxis_a02c2fbfd2097bca3933e285e6712a58d}{getOddsValues}(conditionTracks);\textcolor{comment}{// Calculate}
00647                                                               \textcolor{comment}{// numerator's}
00648                                                               \textcolor{comment}{// odds value}
00649     \textcolor{keywordtype}{double}[] denominatorValues = \hyperlink{classanalysis_1_1_chemotaxis_a02c2fbfd2097bca3933e285e6712a58d}{getOddsValues}(controlTracks);\textcolor{comment}{// Calculate}
00650                                                               \textcolor{comment}{// denominator's}
00651                                                               \textcolor{comment}{// odds value}
00652     \textcolor{keywordtype}{double} numeratorRatio = numeratorValues[0] / numeratorValues[1];
00653     \textcolor{keywordtype}{double} denominatorRatio = denominatorValues[0] / denominatorValues[1];
00654     \textcolor{keywordtype}{double} oddsRatio = numeratorRatio / denominatorRatio;
00655     \textcolor{keywordflow}{return} oddsRatio;
00656   \}
00657 
\hypertarget{_chemotaxis_8java_source_l00666}{}\hyperlink{classanalysis_1_1_chemotaxis_a8ee54f019a9258760e20482e3cd6b851}{00666}   \textcolor{keyword}{private} \textcolor{keywordtype}{double} \hyperlink{classanalysis_1_1_chemotaxis_a8ee54f019a9258760e20482e3cd6b851}{orThreshold}(Map<String, Trial> controls) \{
00667 
00668     \hyperlink{classdata_1_1_serializable_list}{SerializableList} controlTracks = \hyperlink{classanalysis_1_1_chemotaxis_a226e01e0b4acab847ec3b2c1bb233740}{mergeTracks}(controls);
00669     List<Double> oRs = \textcolor{keyword}{new} ArrayList<Double>();
00670     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_ae808f1c980157cfd070c6e09e587e2aa}{NUMSAMPLES}; i++) \{
00671       IJ.showProgress((\textcolor{keywordtype}{double}) i / \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_ae808f1c980157cfd070c6e09e587e2aa}{NUMSAMPLES});
00672       IJ.showStatus(\textcolor{stringliteral}{"Calculating Control Threshold. Shuffle "} + i);
00673       Collections.shuffle(controlTracks);
00674       \textcolor{keywordtype}{double}[] numeratorValues = \hyperlink{classanalysis_1_1_chemotaxis_a02c2fbfd2097bca3933e285e6712a58d}{getOddsValues}(controlTracks);\textcolor{comment}{// Calculate}
00675                                                               \textcolor{comment}{// numerator's}
00676                                                               \textcolor{comment}{// odds value}
00677       Collections.shuffle(controlTracks);
00678       \textcolor{keywordtype}{double}[] denominatorValues = \hyperlink{classanalysis_1_1_chemotaxis_a02c2fbfd2097bca3933e285e6712a58d}{getOddsValues}(controlTracks);\textcolor{comment}{// Calculate}
00679                                                                 \textcolor{comment}{// denominator's}
00680                                                                 \textcolor{comment}{// odds value}
00681       \textcolor{keywordtype}{double} numeratorRatio = numeratorValues[0] / numeratorValues[1];
00682       \textcolor{keywordtype}{double} denominatorRatio = denominatorValues[0] / denominatorValues[1];
00683       \textcolor{keywordtype}{double} oddsRatio = numeratorRatio / denominatorRatio;
00684       oRs.add(oddsRatio);
00685       \textcolor{comment}{// IJ.log(""+oddsRatio);}
00686     \}
00687     Collections.sort(oRs);
00688     \textcolor{keywordflow}{return} oRs.get((\textcolor{keywordtype}{int}) (\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_ae808f1c980157cfd070c6e09e587e2aa}{NUMSAMPLES} * 0.95));
00689   \}
00690 
\hypertarget{_chemotaxis_8java_source_l00701}{}\hyperlink{classanalysis_1_1_chemotaxis_ab23f946e0f1055d348e975e3058f323d}{00701}   \textcolor{keyword}{private} \textcolor{keywordtype}{double} \hyperlink{classanalysis_1_1_chemotaxis_ab23f946e0f1055d348e975e3058f323d}{relativeAngle}(\hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} previous, 
      \hyperlink{classdata_1_1_spermatozoon}{Spermatozoon} next) \{ \textcolor{comment}{// With}
00702                                                                            \textcolor{comment}{// gradient}
00703                                                                            \textcolor{comment}{// direction}
00704     \textcolor{keywordtype}{double} angleDirection = (2 * Math.PI + \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a11ad187f45e1f7add56bde4071bfdf74}{angleDirection} * Math.PI / 180) % (2 
      * Math.PI);
00705     \textcolor{keywordtype}{float} diffX = next.\hyperlink{classdata_1_1_spermatozoon_ad0da36b2558901e21e7a30f6c227a45e}{x} - previous.\hyperlink{classdata_1_1_spermatozoon_ad0da36b2558901e21e7a30f6c227a45e}{x};
00706     \textcolor{keywordtype}{float} diffY = next.\hyperlink{classdata_1_1_spermatozoon_aa4f0d3eebc3c443f9be81bf48561a217}{y} - previous.\hyperlink{classdata_1_1_spermatozoon_aa4f0d3eebc3c443f9be81bf48561a217}{y};
00707     \textcolor{keywordtype}{double} angle = (2 * Math.PI + Math.atan2(diffY, diffX)) % (2 * Math.PI); \textcolor{comment}{// Absolute}
00708                                                                              \textcolor{comment}{// angle}
00709     angle = (2 * Math.PI + angle - angleDirection) % (2 * Math.PI); \textcolor{comment}{// Relative}
00710                                                                     \textcolor{comment}{// angle}
00711                                                                     \textcolor{comment}{// between}
00712                                                                     \textcolor{comment}{// interval}
00713                                                                     \textcolor{comment}{// [0,2*Pi]}
00714     \textcolor{keywordflow}{if} (angle > Math.PI) \{
00715       angle = -(2 * Math.PI - angle);
00716     \}
00717     \textcolor{keywordflow}{return} angle; \textcolor{comment}{// Between [-PI,PI]}
00718   \}
00719 
\hypertarget{_chemotaxis_8java_source_l00724}{}\hyperlink{classanalysis_1_1_chemotaxis_aef66a58ab7f95817a68a3429550562fc}{00724}   \textcolor{keyword}{public} \textcolor{keywordtype}{void} \hyperlink{classanalysis_1_1_chemotaxis_aef66a58ab7f95817a68a3429550562fc}{selectAnalysis}() \{
00725     \textcolor{comment}{// Ask if user wants to analyze a file or directory}
00726     Object[] options = \{ \textcolor{stringliteral}{"File"}, \textcolor{stringliteral}{"Directory"}, \textcolor{stringliteral}{" Multiple Simulations"} \};
00727     String question = \textcolor{stringliteral}{"What do you want to analyze?"};
00728     String title = \textcolor{stringliteral}{"Choose one analysis..."};
00729     \textcolor{keyword}{final} \textcolor{keywordtype}{int} FILE = 0;
00730     \textcolor{keyword}{final} \textcolor{keywordtype}{int} DIR = 1;
00731     \textcolor{keyword}{final} \textcolor{keywordtype}{int} SIMULATION = 2;
00732     \hyperlink{classfunctions_1_1_utils}{Utils} utils = \textcolor{keyword}{new} \hyperlink{classfunctions_1_1_utils}{Utils}();
00733     \textcolor{keywordtype}{int} sourceSelection = utils.\hyperlink{classfunctions_1_1_utils_a0e53c856e8bb35342f949c2f320d0e74}{analysisSelectionDialog}(options, question, title);
00734     \textcolor{keywordflow}{if} (sourceSelection < 0) \{
00735       \textcolor{keywordflow}{return};
00736     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (sourceSelection == FILE) \{\textcolor{comment}{// File}
00737       analysis = \hyperlink{enumanalysis_1_1_chemotaxis_1_1_type_of_analysis}{TypeOfAnalysis}.\hyperlink{enumanalysis_1_1_chemotaxis_1_1_type_of_analysis_a2d2e1e42ff8abcd21e8ddb4d502d9ec3}{INDEXESFILE}; \textcolor{comment}{// It's not possible to carry on}
00738                                              \textcolor{comment}{// bootstrapping analysis in a}
00739                                              \textcolor{comment}{// single file}
00740     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (sourceSelection == DIR || sourceSelection == SIMULATION) \{\textcolor{comment}{// Directory}
00741                                                                          \textcolor{comment}{// or}
00742                                                                          \textcolor{comment}{// simulations}
00743       \textcolor{comment}{// Ask user which analysis wants to apply}
00744       Object[] options2 = \{ \textcolor{stringliteral}{"Ch-Index"}, \textcolor{stringliteral}{"BOOTSTRAPPING"} \};
00745       question = \textcolor{stringliteral}{"Which analysis do you want to apply to the data?"};
00746       title = \textcolor{stringliteral}{"Choose one analysis..."};
00747       \textcolor{keywordtype}{int} analysisSelection = utils.\hyperlink{classfunctions_1_1_utils_a0e53c856e8bb35342f949c2f320d0e74}{analysisSelectionDialog}(options2, question, 
      title);
00748       \textcolor{keyword}{final} \textcolor{keywordtype}{int} CHINDEX = 0;
00749       \textcolor{keyword}{final} \textcolor{keywordtype}{int} BOOTSTRAPPING = 1;
00750       \textcolor{keywordflow}{if} (analysisSelection < 0)
00751         \textcolor{keywordflow}{return};
00752       \textcolor{keywordflow}{if} (sourceSelection == DIR) \{
00753         \textcolor{keywordflow}{if} (analysisSelection == CHINDEX) \{
00754           analysis = \hyperlink{enumanalysis_1_1_chemotaxis_1_1_type_of_analysis}{TypeOfAnalysis}.\hyperlink{enumanalysis_1_1_chemotaxis_1_1_type_of_analysis_aea93300e25d2c79a263d702652974555}{INDEXESDIRECTORY};
00755         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (analysisSelection == BOOTSTRAPPING) \{
00756           analysis = \hyperlink{enumanalysis_1_1_chemotaxis_1_1_type_of_analysis}{TypeOfAnalysis}.\hyperlink{enumanalysis_1_1_chemotaxis_1_1_type_of_analysis_ad9b1fe1a91148ef56f2b25bb3578764f}{BOOTSTRAPPING};
00757         \}
00758       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (sourceSelection == SIMULATION) \{ \textcolor{comment}{// Simulations}
00759         \textcolor{keywordflow}{if} (analysisSelection == CHINDEX) \{
00760           analysis = \hyperlink{enumanalysis_1_1_chemotaxis_1_1_type_of_analysis}{TypeOfAnalysis}.\hyperlink{enumanalysis_1_1_chemotaxis_1_1_type_of_analysis_a8c82f8309b37b928874804133c555393}{INDEXESSIMULATIONS};
00761         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (analysisSelection == BOOTSTRAPPING) \{
00762           analysis = \hyperlink{enumanalysis_1_1_chemotaxis_1_1_type_of_analysis}{TypeOfAnalysis}.\hyperlink{enumanalysis_1_1_chemotaxis_1_1_type_of_analysis_a7520eb9cb2be4df8fff8c63292caed13}{BOOTSTRAPPINGSIMULATIONS};
00763         \}
00764       \}
00765     \}
00766   \}
00767 
\hypertarget{_chemotaxis_8java_source_l00781}{}\hyperlink{classanalysis_1_1_chemotaxis_ac5db76309b6da4b0f351cdbb5876fec4}{00781}   \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{classanalysis_1_1_chemotaxis_ac5db76309b6da4b0f351cdbb5876fec4}{setBootstrappingResults}(ResultsTable rt, \textcolor{keywordtype}{double} 
      \hyperlink{classanalysis_1_1_chemotaxis_a4cf45f4c73ebe44a71a622c690f0b331}{or}, \textcolor{keywordtype}{double} th, \hyperlink{classdata_1_1_trial}{Trial} trial) \{
00782     rt.incrementCounter();
00783     rt.addValue(\textcolor{stringliteral}{"ID"}, trial.\hyperlink{classdata_1_1_trial_a317298c3409575f71e43acd3f73ce295}{ID});
00784     rt.addValue(\textcolor{stringliteral}{"OR"}, or);
00785     rt.addValue(\textcolor{stringliteral}{"Threshold"}, th);
00786     \textcolor{keywordflow}{if} (or > (th)) \{
00787       rt.addValue(\textcolor{stringliteral}{"Result"}, \textcolor{stringliteral}{"POSITIVE"});
00788     \} \textcolor{keywordflow}{else} \{
00789       rt.addValue(\textcolor{stringliteral}{"Result"}, \textcolor{stringliteral}{"-"});
00790     \}
00791     rt.addValue(\textcolor{stringliteral}{"Type"}, trial.\hyperlink{classdata_1_1_trial_a0b86e44425dbe3c9d866aa273f87828a}{type});
00792     rt.addValue(\textcolor{stringliteral}{"Source"}, trial.\hyperlink{classdata_1_1_trial_a00baeba9d13a88ce01098a02d1e570d5}{source});
00793     \textcolor{keywordflow}{if} (\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a8c0dba3f8308ea1257549b3cef11ea23}{compareOppositeDirections})
00794       rt.addValue(\textcolor{stringliteral}{"COD"}, \textcolor{stringliteral}{"YES"});
00795     \textcolor{keywordflow}{else}
00796       rt.addValue(\textcolor{stringliteral}{"COD"}, \textcolor{stringliteral}{"NO"});
00797     \textcolor{keywordflow}{if} (!\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a3e07114fb70a676dfe24fad6be8c3c75}{male}.isEmpty())
00798       rt.addValue(\textcolor{stringliteral}{"Male"}, \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a3e07114fb70a676dfe24fad6be8c3c75}{male});
00799     \textcolor{keywordflow}{if} (!\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_aecbab8174a6d72649883508cf9940d58}{date}.isEmpty())
00800       rt.addValue(\textcolor{stringliteral}{"Date"}, \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_aecbab8174a6d72649883508cf9940d58}{date});
00801     \textcolor{keywordflow}{if} (!\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a253e4e926c0399ed1ae42b5a5989824d}{genericField}.isEmpty())
00802       rt.addValue(\textcolor{stringliteral}{"Generic Field"}, \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a253e4e926c0399ed1ae42b5a5989824d}{genericField});
00803   \}
00804 
\hypertarget{_chemotaxis_8java_source_l00818}{}\hyperlink{classanalysis_1_1_chemotaxis_a9c90c33405ef04f0e75e5f8dcb56520e}{00818}   \textcolor{keyword}{private} \textcolor{keywordtype}{void} \hyperlink{classanalysis_1_1_chemotaxis_a9c90c33405ef04f0e75e5f8dcb56520e}{setIndexesResults}(ResultsTable rt, \hyperlink{classdata_1_1_trial}{Trial} trial, \textcolor{keywordtype}{float} chIdx, \textcolor{keywordtype}{float} 
      slIdx) \{
00819     \textcolor{keywordtype}{int} nTracks = trial.\hyperlink{classdata_1_1_trial_ab0c3156759c41236f7f0bc83e1e5ef8f}{tracks}.size();
00820     rt.incrementCounter();
00821     rt.addValue(\textcolor{stringliteral}{"nTracks"}, nTracks);
00822     rt.addValue(\textcolor{stringliteral}{"Ch-Index"}, chIdx);
00823     rt.addValue(\textcolor{stringliteral}{"Sl-Index"}, slIdx);
00824     rt.addValue(\textcolor{stringliteral}{"Type"}, trial.\hyperlink{classdata_1_1_trial_a0b86e44425dbe3c9d866aa273f87828a}{type});
00825     rt.addValue(\textcolor{stringliteral}{"Direction (Degrees)"}, \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a11ad187f45e1f7add56bde4071bfdf74}{angleDirection});
00826     rt.addValue(\textcolor{stringliteral}{"ArcChemotaxis (Degrees)"}, \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a42568ad774d8f4ccb9535aeda39fc883}{angleAmplitude});
00827     rt.addValue(\textcolor{stringliteral}{"ID"}, trial.\hyperlink{classdata_1_1_trial_a317298c3409575f71e43acd3f73ce295}{ID});
00828     rt.addValue(\textcolor{stringliteral}{"Source"}, trial.\hyperlink{classdata_1_1_trial_a00baeba9d13a88ce01098a02d1e570d5}{source});
00829     \textcolor{keywordflow}{if} (\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a8c0dba3f8308ea1257549b3cef11ea23}{compareOppositeDirections})
00830       rt.addValue(\textcolor{stringliteral}{"COD"}, \textcolor{stringliteral}{"YES"});
00831     \textcolor{keywordflow}{else}
00832       rt.addValue(\textcolor{stringliteral}{"COD"}, \textcolor{stringliteral}{"NO"});
00833     \textcolor{keywordflow}{if} (!\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a3e07114fb70a676dfe24fad6be8c3c75}{male}.isEmpty())
00834       rt.addValue(\textcolor{stringliteral}{"Male"}, \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a3e07114fb70a676dfe24fad6be8c3c75}{male});
00835     \textcolor{keywordflow}{if} (!\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_aecbab8174a6d72649883508cf9940d58}{date}.isEmpty())
00836       rt.addValue(\textcolor{stringliteral}{"Date"}, \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_aecbab8174a6d72649883508cf9940d58}{date});
00837     \textcolor{keywordflow}{if} (!\hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a253e4e926c0399ed1ae42b5a5989824d}{genericField}.isEmpty())
00838       rt.addValue(\textcolor{stringliteral}{"Generic Field"}, \hyperlink{classdata_1_1_params}{Params}.\hyperlink{classdata_1_1_params_a253e4e926c0399ed1ae42b5a5989824d}{genericField});
00839   \}
00840 \}
\end{DoxyCode}
